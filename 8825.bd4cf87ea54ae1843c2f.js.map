{"version":3,"file":"8825.bd4cf87ea54ae1843c2f.js","mappings":"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","sources":["webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/layers/KnowledgeGraphLayer.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/layers/mixins/ArcGISService.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../core/Collection.js\";import i from\"../core/Error.js\";import o from\"../core/Logger.js\";import{getOrCreateMapValue as s}from\"../core/MapUtils.js\";import{MultiOriginJSONMixin as a}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as r}from\"../core/promiseUtils.js\";import{watch as n,sync as p}from\"../core/reactiveUtils.js\";import{isAbsolute as l,join as d}from\"../core/urlUtils.js\";import{generateUUID as h}from\"../core/uuid.js\";import{property as y}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/RandomLCG.js\";import{reader as c}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as m}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as u}from\"../core/accessorSupport/decorators/writer.js\";import{OriginId as f,idToName as g,nameToId as w}from\"../core/accessorSupport/PropertyOrigin.js\";import b from\"./Layer.js\";import{KnowledgeGraphLayerDataManager as M}from\"./knowledgeGraph/KnowledgeGraphLayerDataManager.js\";import T from\"./knowledgeGraph/KnowledgeGraphSublayer.js\";import{initializeLayersFromClientData as S}from\"./knowledgeGraph/layerUtils.js\";import{fetchAndConvertSerializedKgIdMap as _,serializeInclusionDefinitionToIdCollectionsMapPbf as D}from\"./knowledgeGraph/supportUtils.js\";import{ArcGISService as L}from\"./mixins/ArcGISService.js\";import{BlendLayer as j}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as v}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as k}from\"./mixins/OperationalLayer.js\";import{PortalLayer as G}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as C}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as A}from\"./mixins/ScaleRangeLayer.js\";import{url as E}from\"./support/commonProperties.js\";import{fetchKnowledgeGraph as N}from\"../rest/knowledgeGraphService.js\";import{f as R,t as I}from\"../chunks/persistableUrlUtils.js\";let U=class extends(j(A(C(L(k(G(a(v(b))))))))){constructor(e){super(e),this._graphTypeLookup=new Map,this._namedTypesModified=!1,this.dataManager=null,this.definitionSetMap=null,this.knowledgeGraph=null,this.layers=new(t.ofType(T)),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.operationalLayerType=\"KnowledgeGraphLayer\",this.sublayerIdsCache=new Map,this.tables=new(t.ofType(T)),this.type=\"knowledge-graph\",this.url=null,this.addHandles(n((()=>this.layers.concat(this.tables)),((e,t)=>this._handleSublayersChange(e,t)),p))}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){try{await this.loadFromPortal({supportedTypes:[\"Knowledge Graph Layer\"]},e)}catch(t){r(t)}await this._fetchMetadata(),await this._initializeLayerProperties(),this.loadLayerAssumingLocalCache(),await S(this)}async _fetchMetadata(){if(!this.url)throw new i(\"knowledge-graph:missing-url\",\"KnowledgeGraphLayer must be created with a url\");const e=await N(this.url);this.knowledgeGraph=e,this._forEachGraphType((e=>{e.name&&this._graphTypeLookup.set(e.name,e)}))}async _initializeLayerProperties(){this.originIdOf(\"inclusionModeDefinition\")===f.USER?this._validateInclusionModeDefinition():await this._initializeInclusionModeDefinition(),this._setMemberTypes(),this.dataManager=new M({knowledgeGraph:this.knowledgeGraph,inclusionModeDefinition:this.inclusionModeDefinition})}async _initializeInclusionModeDefinition(){const e=this.definitionSetMap?await _(this.definitionSetMap,!0):{generateAllSublayers:!0,namedTypeDefinitions:new Map};[...this.layers.toArray(),...this.tables.toArray()].forEach((t=>{const i=this._graphTypeLookup.get(t.graphTypeName);i&&!e.namedTypeDefinitions.has(i.name)&&e.namedTypeDefinitions.set(i.name,{useAllData:!0})})),this.setAtOrigin(\"inclusionModeDefinition\",e,g(this.originIdOf(\"definitionSetMap\")))}_validateInclusionModeDefinition(){const{inclusionModeDefinition:e}=this;if(!e)return;const{namedTypeDefinitions:t}=e;if(t?.size>0)t.forEach(((e,i)=>{const s=this._graphTypeLookup.get(i);if(!s)return o.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void t.delete(i);\"relationship\"!==s.type&&\"entity\"!==s.type&&(o.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't properly modeled and will be removed`),t.delete(i))}));else if(!e.generateAllSublayers)throw new i(\"knowledge-graph:composite-layer-constructor\",\"If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined\")}_setMemberTypes(){let e=[],t=[];const{inclusionModeDefinition:i}=this,o=i?.namedTypeDefinitions;!i||i.generateAllSublayers?(e=this.knowledgeGraph.dataModel?.entityTypes??[],t=this.knowledgeGraph.dataModel?.relationshipTypes??[]):o&&o.size>0&&o.forEach(((i,o)=>{const s=this._graphTypeLookup.get(o);switch(s?.type){case\"relationship\":t.push(s);break;case\"entity\":e.push(s)}})),this.memberEntityTypes=e,this.memberRelationshipTypes=t}_forEachGraphType(e){[...this.knowledgeGraph.dataModel?.entityTypes??[],...this.knowledgeGraph.dataModel?.relationshipTypes??[]].forEach((t=>{e(t)}))}_refreshNamedTypes(){this._namedTypesModified=!0;for(const e of this.layers)e.emit(\"refresh\",{dataChanged:!0});for(const e of this.tables)e.emit(\"refresh\",{dataChanged:!0})}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t){const e=this._graphTypeLookup.get(i);e&&(this._addSublayer(e),\"entity\"===e.type?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),this.dataManager.sublayerCaches.set(i,new Map))}await S(this,t),this._refreshNamedTypes()}_createSublayers(e,t,i){e.forEach((e=>{const o=this._createSublayer(e);i(o)&&t.push(o),this._updateSublayerCaches(e)}))}_addSublayer(e){const t=this._createSublayer(e);return t.geometryType?this.layers.push(t):this.tables.push(t),t}_createSublayer(e){return new T({objectType:e,parentCompositeLayer:this,graphType:e.type})}_updateSublayers(e,t){t.forEach((t=>{t.parentCompositeLayer=this;const i=e.find((e=>e.type===t.graphType&&e.name===t.graphTypeName));i&&(t.objectType=i,this._updateSublayerCaches(i))}))}_updateSublayerCaches(e){const t=this.dataManager.sublayerCaches;t.has(e.name)||t.set(e.name,new Map)}_saveUrlAsNewResource(e,t,i,o){e[t]=\"<pending>\",i.pendingOperations.push(x(this.inclusionModeDefinition).then((s=>{const a=P(o);e[t]=a.itemRelativeUrl,i.toAdd.push({resource:a,content:{type:\"blob\",blob:s},compress:!1,finish:e=>{this.definitionSetMap=e.url}})})))}_displaysAllRecords(e){for(const[,{useAllData:t}]of e.namedTypeDefinitions)if(!t)return!1;return!0}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null})),this.removeHandles(\"sublayers-owner\")),e&&(e.forEach((e=>{e.parent=this})),this.addHandles([e.on(\"after-add\",(({item:e})=>{e.parent=this})),e.on(\"after-remove\",(({item:e})=>{e.parent=null}))],\"sublayers-owner\"))}readDefinitionSetMap(e,t,i){return R(e,i)}writeDefinitionSetMap(e,t,i,o){const s=o?.portalItem,a=o?.resources,r=w(o?.origin);if(!s||!a||null==r)return void(e&&(t[i]=I(e,o)));const{inclusionModeDefinition:n}=this;if(!n||this._displaysAllRecords(n))return void(this.definitionSetMap=null);const p=this.originIdOf(\"inclusionModeDefinition\");if(p===f.USER||this._namedTypesModified||r<p)this._saveUrlAsNewResource(t,i,a,s);else if(r===p&&e){const r=I(e,o);l(r)?this._saveUrlAsNewResource(t,i,a,s):t[i]=r}}set inclusionModeDefinition(e){\"loaded\"!==this.loadStatus&&\"failed\"!==this.loadStatus?this._set(\"inclusionModeDefinition\",e):o.getLogger(this).error(\"#inclusionModeDefinition\",\"inclusionModeDefinition cannot be changed after the layer is loaded.\")}loadLayerAssumingLocalCache(){const e=[...this.memberEntityTypes,...this.memberRelationshipTypes];this.originIdOf(\"layers\")===f.DEFAULTS?this._createSublayers(e,this.layers,(e=>!!e.geometryType)):this._updateSublayers(e,this.layers),this.originIdOf(\"tables\")===f.DEFAULTS?this._createSublayers(e,this.tables,(e=>!e.geometryType)):this._updateSublayers(e,this.tables),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{const i=s(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{i.add(e.id)}))}))}async addRecords(e){await this._handleNewRecords(e)}async removeRecords(e){const t=[];for(const i of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(i.typeName)?.members?.has(i.id)&&t.push(i);this.dataManager.removeFromLayer(t);for(const i of t)this.sublayerIdsCache.get(i.typeName)?.delete(i.id);return this._refreshNamedTypes(),t}};e([y()],U.prototype,\"dataManager\",void 0),e([y({json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],U.prototype,\"definitionSetMap\",void 0),e([c(\"definitionSetMap\")],U.prototype,\"readDefinitionSetMap\",null),e([u(\"definitionSetMap\")],U.prototype,\"writeDefinitionSetMap\",null),e([y()],U.prototype,\"inclusionModeDefinition\",null),e([y()],U.prototype,\"knowledgeGraph\",void 0),e([y({type:t.ofType(T),json:{write:{ignoreOrigin:!0}}})],U.prototype,\"layers\",void 0),e([y()],U.prototype,\"memberEntityTypes\",void 0),e([y()],U.prototype,\"memberRelationshipTypes\",void 0),e([y({type:[\"KnowledgeGraphLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([y()],U.prototype,\"sublayerIdsCache\",void 0),e([y({type:t.ofType(T),json:{write:{ignoreOrigin:!0}}})],U.prototype,\"tables\",void 0),e([y({json:{read:!1}})],U.prototype,\"type\",void 0),e([y(E)],U.prototype,\"url\",void 0),U=e([m(\"esri.layers.KnowledgeGraphLayer\")],U);const O=U;async function x(e){const t=await D(e);return new Blob([t],{type:\"application/x-protobuf\"})}function P(e){const t=`definitionSetMap-${h()}.dat`,i=d(\"knowledgeGraphLayer\",t);return e.resourceFromPath(i)}export{O as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Logger.js\";import{property as e}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import{parse as i,sanitizeUrl as o}from\"../support/arcgisLayerUrl.js\";const l=l=>{let p=class extends l{get title(){if(this._get(\"title\")&&\"defaults\"!==this.originOf(\"title\"))return this._get(\"title\");if(this.url){const t=i(this.url);if(null!=t&&t.title)return t.title}return this._get(\"title\")||\"\"}set title(t){this._set(\"title\",t)}set url(t){this._set(\"url\",o(t,r.getLogger(this)))}};return t([e()],p.prototype,\"title\",null),t([e({type:String})],p.prototype,\"url\",null),p=t([s(\"esri.layers.mixins.ArcGISService\")],p),p};export{l as ArcGISService};\n"],"names":["U","constructor","e","super","this","_graphTypeLookup","Map","_namedTypesModified","dataManager","definitionSetMap","knowledgeGraph","layers","ofType","memberEntityTypes","memberRelationshipTypes","operationalLayerType","sublayerIdsCache","tables","type","url","addHandles","concat","t","_handleSublayersChange","load","addResolvingPromise","_doLoad","Promise","resolve","loadFromPortal","supportedTypes","_fetchMetadata","_initializeLayerProperties","loadLayerAssumingLocalCache","_forEachGraphType","name","set","originIdOf","USER","_validateInclusionModeDefinition","_initializeInclusionModeDefinition","_setMemberTypes","inclusionModeDefinition","generateAllSublayers","namedTypeDefinitions","toArray","forEach","i","get","graphTypeName","has","useAllData","setAtOrigin","size","s","getLogger","warn","delete","o","dataModel","entityTypes","relationshipTypes","push","_refreshNamedTypes","emit","dataChanged","_handleNewRecords","addToLayer","typeName","Set","add","id","_addSublayer","entityTypeNames","relationshipTypeNames","sublayerCaches","_createSublayers","_createSublayer","_updateSublayerCaches","geometryType","objectType","parentCompositeLayer","graphType","_updateSublayers","find","_saveUrlAsNewResource","pendingOperations","async","Blob","x","then","a","resourceFromPath","P","itemRelativeUrl","toAdd","resource","content","blob","compress","finish","_displaysAllRecords","parent","removeHandles","on","item","readDefinitionSetMap","writeDefinitionSetMap","portalItem","resources","r","origin","n","p","loadStatus","_set","error","DEFAULTS","members","addRecords","removeRecords","removeFromLayer","prototype","json","write","ignoreOrigin","writerEnsuresNonNull","read","O","l","title","_get","originOf","String"],"sourceRoot":""}