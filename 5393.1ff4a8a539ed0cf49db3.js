"use strict";(self.webpackChunkreact_redux_arcgis_boilerplate=self.webpackChunkreact_redux_arcgis_boilerplate||[]).push([[5393,7774],{35393:function(e,t,r){r.d(t,{applyEdits:function(){return I},r3:function(){return w},uploadAssets:function(){return k},zp:function(){return A}});var n=r(20857),a=r(58842),i=r(62991),s=r(15565),o=r(80861),d=r(37623),u=r(19759),l=r(1874),c=r(87249),p=r(67488),h=r(66559),f=r(46227),m=r(52360),y=r(65452);function g(e){return null!=e?.applyEdits}function b(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function w(e){return e.every(b)}function F(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function A(e){return e.every(F)}async function I(e,t,r,n={}){let u;const c="gdbVersion"in e?e.gdbVersion:null,p=n.gdbVersion??c;if((0,h.Mk)(e)&&e.url)u=(0,h.Zk)(e.url,e.layerId,p,"original-and-current-features"===n.returnServiceEditsOption);else{u=(0,d.Tw)(),u.promise.then((t=>{(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length)&&e.emit("edits",t)}));const t={result:u.promise};e.emit("apply-edits",t)}try{const{results:d,edits:c}=await async function(e,t,r,n){if(await e.load(),!g(t))throw new i.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,y.tk)(e))throw new i.A(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:s,options:d}=await async function(e,t,r){const n=(0,y.BR)(e),s=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),d=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments),u=null!=e.infoFor3D;if(function(e,t,r,n,a,s){if(!e||!n&&!a)throw new i.A(`${s}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&r?.globalIdUsed)throw new i.A(`${s}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&a)throw new i.A(`${s}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!r?.globalIdUsed&&a)throw new i.A(`${s}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}(t,n,r,!!s,!!d,`${e.type}-layer`),!n.data.isVersioned&&r?.gdbVersion)throw new i.A(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!n.editing.supportsRollbackOnFailure&&r?.rollbackOnFailureEnabled)throw new i.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const c={...r};if(null!=c.rollbackOnFailureEnabled||n.editing.supportsRollbackOnFailure||(c.rollbackOnFailureEnabled=!0),c.rollbackOnFailureEnabled||"original-and-current-features"!==c.returnServiceEditsOption||(!1===c.rollbackOnFailureEnabled&&o.A.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),c.rollbackOnFailureEnabled=!0),!n.editing.supportsReturnServiceEditsInSourceSpatialReference&&c.returnServiceEditsInSourceSR)throw new i.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(c.returnServiceEditsInSourceSR&&"original-and-current-features"!==c.returnServiceEditsOption)throw new i.A(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const p=function(e,t,r){const n=function(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&a.A.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}(e);if(n.addFeatures?.length&&!t.operations.supportsAdd)throw new i.A(`${r}:unsupported-operation`,"Layer does not support adding features.");if(n.updateFeatures?.length&&!t.operations.supportsUpdate)throw new i.A(`${r}:unsupported-operation`,"Layer does not support updating features.");if(n.deleteFeatures?.length&&!t.operations.supportsDelete)throw new i.A(`${r}:unsupported-operation`,"Layer does not support deleting features.");return n.addFeatures=n.addFeatures.map(R),n.updateFeatures=n.updateFeatures.map(R),n.addAssetFeatures=[],n}(t,n,`${e.type}-layer`),h=r?.globalIdUsed||u,f=e.fields.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(h){const{globalIdField:t}=e;if(null==t)throw new i.A(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");p.addFeatures.forEach((e=>function(e,t){const{attributes:r}=e;null==r[t]&&(r[t]=(0,l.yS)())}(e,t)))}return p.addFeatures.forEach((t=>function(e,t,r,n){v(e,t,r,n),E(e,t)}(t,e,h,f))),p.updateFeatures.forEach((t=>function(e,t,r,n){v(e,t,r,n),E(e,t);const a=(0,y.BR)(t);if("geometry"in e&&null!=e.geometry&&!a?.editing.supportsGeometryUpdate)throw new i.A(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(t,e,h,f))),p.deleteFeatures.forEach((t=>function(e,t,r,n){v(e,t,r,n)}(t,e,h,f))),p.addAttachments.forEach((t=>$(t,e))),p.updateAttachments.forEach((t=>$(t,e))),u&&await async function(e,t){const{infoFor3D:r}=t;if(null==r)return;if(!(0,m.JQ)(r))throw new i.A(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:n}=e;for(const t of e.addFeatures??[])M(t)&&n.push(t);for(const t of e.updateFeatures??[])M(t)&&n.push(t)}(p,e),{edits:await S(p),options:c}}(e,r,n);return s.addFeatures?.length||s.updateFeatures?.length||s.deleteFeatures?.length||s.addAttachments?.length||s.updateAttachments?.length||s.deleteAttachments?.length?{edits:s,results:await t.applyEdits(s,d)}:{edits:s,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}(e,t,r,n),p=e=>e.filter((e=>!e.error)).map(s.o8),h={edits:c,addedFeatures:p(d.addFeatureResults),updatedFeatures:p(d.updateFeatureResults),deletedFeatures:p(d.deleteFeatureResults),addedAttachments:p(d.addAttachmentResults),updatedAttachments:p(d.updateAttachmentResults),deletedAttachments:p(d.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:d.editMoment?new Date(d.editMoment):null,globalIdToObjectId:n.globalIdToObjectId};return d.editedFeatureResults?.length&&(h.editedFeatures=d.editedFeatureResults),u.resolve(h),d}catch(e){throw u.reject(e),e}}function v(e,t,r,n){if(r){if("attributes"in e&&!e.attributes[t.globalIdField])throw new i.A(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new i.A(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(n.length&&"attributes"in e)for(const r of n){const n=e.attributes[r.name];if(void 0!==n&&!(0,f.OG)(r,n))throw new i.A(`${t.type}-layer:invalid-parameter`,`Big-integer field '${r.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new i.A(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new i.A(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function E(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:r}=e,{spatialReference:n,vertexSpace:a}=r,s=t.spatialReference,o="local"===a.type,d=(0,p.EA)(s),u=(0,p.aI)(s,n),l=u||(0,p.oT)(s)&&((0,p.oT)(n)||(0,p.K8)(n));if(!(o&&d&&l||!o&&!d&&u))throw new i.A(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${a.type} vertex space and a spatial reference wkid:${n.wkid} to a layer with a spatial reference wkid:${s.wkid} is not supported.`)}}function $(e,t){const{feature:r,attachment:n}=e;if(!r||"attributes"in r&&!r.attributes[t.globalIdField])throw new i.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in r)&&!r.globalId)throw new i.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!n.globalId)throw new i.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!n.data&&!n.uploadId)throw new i.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(n.data instanceof File&&n.data.name||n.name))throw new i.A(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&n.uploadId)throw new i.A(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof n.data){const e=(0,u.r$)(n.data);if(e&&!e.isBase64)throw new i.A(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}async function S(e){const t=e.addFeatures??[],r=e.updateFeatures??[],n=t.concat(r).map((e=>e.geometry)),a=await(0,c.el)(n),i=t.length,s=r.length;return a.slice(0,i).forEach(((e,r)=>t[r].geometry=e)),a.slice(i,i+s).forEach(((e,t)=>r[t].geometry=e)),e}function R(e){const t=new n.A;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function M(e){return"mesh"===e?.geometry?.type}function k(e,t,r,n){if(!g(t))throw new i.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new i.A(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(r,n)}},66559:function(e,t,r){r.d(t,{Mk:function(){return h},Zk:function(){return c},w6:function(){return y}});var n=r(82392),a=r(57888),i=r(15565),s=r(37623),o=r(81482),d=(r(6273),r(80861),r(26325)),u=r(6893);const l=new a.A.EventEmitter;function c(e,t,r=null,n=!1){const a=(0,s.Tw)();return n=null==t||n,l.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:r,mayReceiveServiceEdits:n,result:a.promise}),a}const p=Symbol();function h(e){return null!=e&&"object"==typeof e&&p in e}function f(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function m(e,t,r){const n=new URL(e).host,a=u.Z3.get(n),i=e=>!e||e===a;return i(t)&&i(r)||t===r}const y=e=>{var t;let r=class extends e{constructor(...e){super(...e),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:r,gdbVersion:n,mayReceiveServiceEdits:a,result:s}=e,o=t===this.url,d=null!=r&&null!=this.layerId&&r===this.layerId,u=f(this),l=f(this)&&m(t,n,this.gdbVersion);if(!o||u&&!l||!d&&!a)return;const c=s.then((e=>{if(this.lastEditsEventDate=new Date,d&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,i.o8)(e)),e;const r=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(r){const{adds:t,updates:n,deletes:a}=r.editedFeatures,s={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:a?a.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:n?n.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:(0,i.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,i.o8)(e.historicMoment)};return this.emit("edits",s),s}const a={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,i.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,i.o8)(e.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(t,n,a.historicMoment)&&this.emit("edits",a),a})).then((e=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(t,n,e.historicMoment)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:c})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:n}=e,a=t===this.url,i=f(this),s=f(this)&&m(t,r,this.gdbVersion),o=f(this)&&!m(t,this.gdbVersion,null);a&&i&&s&&o&&"historicMoment"in this&&this.historicMoment!==n&&(this.historicMoment=n)},this.when().then((()=>{this.addHandles(function(e){return l.on("apply-edits",new WeakRef(e))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(e){return l.on("update-moment",new WeakRef(e))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(e,t,r){return"historicMoment"in this&&this.historicMoment!==r&&(0,u.w5)(e,t)}};return t=p,(0,n._)([(0,o.MZ)()],r.prototype,"lastEditsEventDate",void 0),r=(0,n._)([(0,d.$)("esri.layers.mixins.EditBusLayer")],r),r}},52360:function(e,t,r){r.d(t,{CW:function(){return h},Fm:function(){return d},JQ:function(){return p},JZ:function(){return A},ND:function(){return m},R_:function(){return s},U9:function(){return c},fu:function(){return a},nr:function(){return f},oF:function(){return i},rq:function(){return u},z$:function(){return l}});const n=[["binary","application/octet-stream","bin",""]];function a(e,t){return null!=g(t.name,e?.supportedFormats??[])}function i(e,t){if(!e)return!1;const r=u(t,e.supportedFormats??[]);return null!=r&&e.editFormats.includes(r)}function s(e,t){return b(function(e,t){const r=e.toLowerCase();return y(t).find((e=>w(e)===r))}(e,t))}function o(e,t){return b(g(e,t))}function d(e,t){return w(function(e,t){return y(t).find((t=>b(t)===e))}(e,t))}function u(e,t){return o(e.name,t)??s(e.type,t)}function l(e,t,r){return s(e,r)??o(t,r)}function c({supportedFormats:e}){return l("model/gltf-binary","glb",e)}function p(e){const t=c(e);return null!=t&&e.editFormats.includes(t)}function h({supportedFormats:e}){return l("model/gltf+json","gltf",e)}function f({supportedFormats:e}){return l("application/esri3do-SR_world","wld",e)}function m({supportedFormats:e}){return l("application/esri3do-SR_prj","prj",e)}function y(e){return[...n,...e]}function g(e,t){const r=e.toLowerCase();return y(t).find((e=>F(e).some((e=>r.endsWith(e)))))}function b(e){return e?.[0]}function w(e){return e?.[1].toLowerCase()}function F(e){return e?.[2].split(",").map((e=>e.toLowerCase()))??[]}function A(e){return e.tables?.find((e=>"assetMaps"===e.role))}},6893:function(e,t,r){r.d(t,{TA:function(){return a},We:function(){return o},Z3:function(){return i},ZJ:function(){return d},w5:function(){return u}});var n=r(38116);const a=(0,r(1874).vD)(),i=new Map,s=new Map;new Map;async function o(e,t,r){if(!e||!r)return!1;if(!t)return!0;const a=new URL(e).host;let s=i.get(a);if(!s){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await(0,n.A)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===t}async function d(e,t,n=!1){if(!e||!t)return!0;const i=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),o=s.get(i)?.entries();if(o)for(const[e,s]of o)if(s.name===t){const t=!s.stack?.hasForwardEdits();if(!t&&n){const[{deleteForwardEdits:t},{default:n}]=await Promise.all([r.e(1611).then(r.bind(r,71611)),r.e(1767).then(r.bind(r,1767))]),o=await t(i,e,new n({sessionId:a,moment:s.moment}));return o.success&&s.stack?.clearForwardEdits(),o.success}return t}return!0}function u(e,t){if(!e)return!1;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=s.get(r)?.entries();if(n)for(const[e,r]of n)if(r.name===t)return"edit"===r.lockType;return!1}}}]);
//# sourceMappingURL=5393.1ff4a8a539ed0cf49db3.js.map