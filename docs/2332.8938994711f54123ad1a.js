"use strict";(self.webpackChunkreact_redux_arcgis_boilerplate=self.webpackChunkreact_redux_arcgis_boilerplate||[]).push([[1814,2332],{38382:function(e,t,r){r.d(t,{C:function(){return y},b:function(){return m}});var i=r(77788),n=r(29592),o=r(31790),s=r(38587),a=r(73713),l=r(85807),c=r(24578),h=r(83660),d=r(69952),u=r(92121),g=r(41014),p=r(92624),f=r(33763),v=r(288);function m(e){const t=new p.N5,{vertex:r,fragment:m,attributes:y,varyings:_}=t;(0,d.NB)(r,e),t.include(o.d,e),t.include(a.c,e),t.include(c.A,e),t.include(s.g,e),t.include(n.HQ,e),t.include(v.z,e),y.add(f.r.POSITION,"vec3"),e.vvColor&&y.add(f.r.COLORFEATUREATTRIBUTE,"float"),_.add("vColor","vec4"),_.add("vpos","vec3");const x=e.terrainDepthTest&&e.output===i.V.Color;return x&&_.add("depth","float"),r.uniforms.add(new u.E("eColor",(e=>e.color))),r.main.add(g.H`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${x?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),t.include(n.HQ,e),x&&t.include(l.Z,e),m.include(h.a),m.main.add(g.H`
    discardBySlice(vpos);
    ${x?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},47798:function(e,t,r){r.d(t,{H:function(){return d},b:function(){return h}});var i=r(51269),n=r(88351),o=r(19635),s=r(88531),a=r(41014),l=r(92624),c=r(19778);function h(){const e=new l.N5;e.include(i.Q);const{fragment:t}=e;return t.uniforms.add(new c.N("highlightTexture",(e=>e.highlightTexture)),new c.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new o.m("pixelRatio",(e=>e.pixelRatio)),new o.m("occludedIntensityFactor",(e=>e.occludedFactor)),new s.c("maxHighlightLevel",(e=>e.maxHighlightLevel))),t.constants.add("pixelSampleScale","float",1),e.include(n.y),t.code.add(a.H`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(a.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},83350:function(e,t,r){r.d(t,{H:function(){return a},a:function(){return u},b:function(){return d},c:function(){return l},g:function(){return c},o:function(){return h}});var i=r(28019),n=r(41014),o=r(92624),s=r(29247);class a extends n.Y{}function l(){const e=new o.N5,{outputs:t,fragment:r}=e;return e.include(i.c),r.uniforms.add(new s.o("textureInput",(e=>e.input))),r.constants.add("outlineWidth","int",Math.ceil(h)),r.constants.add("cellSize","int",c),t.add("fragGrid","vec2"),r.main.add(n.H`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`),e}const c=32,h=9,d=.4,u=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:a,blurSize:d,build:l,gridCellPixelSize:c,outlineSize:h},Symbol.toStringTag,{value:"Module"}))},77371:function(e,t,r){r.d(t,{H:function(){return h},b:function(){return c}});var i=r(51269),n=r(88351),o=r(88531),s=r(41014),a=r(92624),l=r(19778);function c(){const e=new a.N5;e.include(i.Q),e.include(n.y);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new l.N("highlightTexture",(e=>e.highlightTexture)),new o.c("maxHighlightLevel",(e=>e.maxHighlightLevel)),new o.c("highlightLevel",(e=>e.highlightLevel))),e.include(n.y),t.main.add(s.H`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},58062:function(e,t,r){r.d(t,{O:function(){return h},a:function(){return u},b:function(){return d}});var i=r(68986),n=r(28019),o=r(19635),s=r(88531),a=r(41014),l=r(92624),c=r(19778);class h extends a.Y{constructor(){super(...arguments),this.overlayIndex=i.vr.INNER,this.opacity=1}}function d(){const e=new l.N5;return e.include(n.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new s.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new o.m("opacity",(e=>e.opacity))),e.fragment.main.add(a.H`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},23298:function(e,t,r){r.d(t,{S:function(){return g},b:function(){return u}});var i=r(51269),n=r(88351),o=r(37138),s=r(19635),a=r(88531),l=r(41014),c=r(92624),h=r(19778),d=r(83350);function u(){const e=new c.N5;e.include(i.Q);const{fragment:t}=e;return t.uniforms.add(new h.N("blurInput",(e=>e.singleHighlightBlurTexture)),new o.t("blurSize",(e=>e.blurSize)),new h.N("highlightTexture",(e=>e.highlightTexture)),new h.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new a.c("highlightLevel",(e=>e.highlightLevel)),new s.m("occludedIntensityFactor",(e=>e.occludedFactor))),t.constants.add("inner","float",1-(d.o-d.b)/d.o),e.include(n.y),t.main.add(l.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const g=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},20527:function(e,t,r){r.d(t,{S:function(){return c},a:function(){return d},b:function(){return h}});var i=r(56560),n=r(51269),o=r(37138),s=r(41014),a=r(92624),l=r(29247);class c extends s.Y{constructor(){super(...arguments),this.blurSize=(0,i.vt)()}}function h(){const e=new a.N5;return e.include(n.Q),e.fragment.uniforms.add(new o.t("blurSize",(e=>e.blurSize)),new l.o("blurInput",(e=>e.blurInput))),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.main.add(s.H`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},30607:function(e,t,r){r.d(t,{T:function(){return c},a:function(){return d},b:function(){return h}});var i=r(19913),n=r(28019),o=r(64802),s=r(41014),a=r(92624),l=r(19778);class c extends s.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function h(){const e=new a.N5;return e.include(n.c),e.fragment.uniforms.add(new l.N("tex",(e=>e.texture)),new o.t("uColor",(e=>e.color))),e.fragment.main.add(s.H`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},91814:function(e,t,r){function i(e,t,r){r=r||2;var i,o,a,l,c,h,u,g=t&&t.length,p=g?t[0]*r:e.length,f=n(e,0,p,r,!0),v=[];if(!f||f.next===f.prev)return v;if(g&&(f=d(e,t,f,r)),e.length>80*r){i=a=e[0],o=l=e[1];for(var m=r;m<p;m+=r)(c=e[m])<i&&(i=c),(h=e[m+1])<o&&(o=h),c>a&&(a=c),h>l&&(l=h);u=0!==(u=Math.max(a-i,l-o))?1/u:0}return s(f,v,r,i,o,u),v}function n(e,t,r,i,n){var o,s;if(n===M(e,t,r,i)>0)for(o=t;o<r;o+=i)s=P(o,e[o],e[o+1],s);else for(o=r-i;o>=t;o-=i)s=P(o,e[o],e[o+1],s);if(s&&C(s,s.next)){var a=s.next;D(s),s=a}return s}function o(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!C(i,i.next)&&0!==w(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(D(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function s(e,t,r,i,n,d,u){if(e){!u&&d&&v(e,i,n,d);for(var g,p,f=e;e.prev!==e.next;)if(g=e.prev,p=e.next,d?l(e,i,n,d):a(e))t.push(g.i/r),t.push(e.i/r),t.push(p.i/r),D(e),e=p.next,f=p.next;else if((e=p)===f){u?1===u?s(e=c(o(e),t,r),t,r,i,n,d,2):2===u&&h(e,t,r,i,n,d):s(o(e),t,r,i,n,d,1);break}}}function a(e){var t=e.prev,r=e,i=e.next;if(w(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(_(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&w(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,r,i){var n=e.prev,o=e,s=e.next;if(w(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,c=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,h=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,d=m(a,l,t,r,i),u=m(c,h,t,r,i),g=e.prevZ,p=e.nextZ;g&&g.z>=d&&p&&p.z<=u;){if(g!==e.prev&&g!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,p!==e.prev&&p!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;g&&g.z>=d;){if(g!==e.prev&&g!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;p&&p.z<=u;){if(p!==e.prev&&p!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function c(e,t,r){var i=e;do{var n=i.prev,s=i.next.next;!C(n,s)&&b(n,i,i.next,s)&&O(n,s)&&O(s,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(s.i/r),D(i),D(i.next),i=e=s),i=i.next}while(i!==e);return o(i)}function h(e,t,r,i,n,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&x(l,c)){var h=R(l,c);return l=o(l,l.next),h=o(h,h.next),s(l,t,r,i,n,a),void s(h,t,r,i,n,a)}c=c.next}l=l.next}while(l!==e)}function d(e,t,r,i){var s,a,l,c=[];for(s=0,a=t.length;s<a;s++)(l=n(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),c.push(y(l));for(c.sort(u),s=0;s<c.length;s++)r=o(r=p(c[s],r),r.next);return r}function u(e,t){return e.x-t.x}function g(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function p(e,t){var r=function(e,t){var r,i=t,n=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s){if(s=a,a===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r;var l,c=r,h=r.x,d=r.y,u=1/0;i=r;do{n>=i.x&&i.x>=h&&n!==i.x&&_(o<d?n:s,o,h,d,o<d?s:n,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(n-i.x),O(i,e)&&(l<u||l===u&&(i.x>r.x||i.x===r.x&&f(r,i)))&&(r=i,u=l)),i=i.next}while(i!==c);return r}(e,t);if(!r)return t;var i=R(r,e),n=o(r,r.next);let s=g(i);return o(s,s.next),n=g(n),g(t===r?n:t)}function f(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function v(e,t,r,i){var n=e;do{null===n.z&&(n.z=m(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,s,a,l,c=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(s>1)}(n)}function m(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function _(e,t,r,i,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(n-s)*(i-a)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(O(e,t)&&O(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||C(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function C(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,i){var n=T(w(e,t,r)),o=T(w(e,t,i)),s=T(w(r,i,e)),a=T(w(r,i,t));return n!==o&&s!==a||!(0!==n||!S(e,r,t))||!(0!==o||!S(e,i,t))||!(0!==s||!S(r,e,i))||!(0!==a||!S(r,t,i))}function S(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function T(e){return e>0?1:e<0?-1:0}function O(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function R(e,t){var r=new A(e.i,e.x,e.y),i=new A(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function P(e,t,r,i){var n=new A(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function D(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,r,i){for(var n=0,o=t,s=r-i;o<r;o+=i)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}r.d(t,{e:function(){return i}}),i.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,s=Math.abs(M(e,0,o,r));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,h=a<l-1?t[a+1]*r:e.length;s-=Math.abs(M(e,c,h,r))}var d=0;for(a=0;a<i.length;a+=3){var u=i[a]*r,g=i[a+1]*r,p=i[a+2]*r;d+=Math.abs((e[u]-e[p])*(e[g+1]-e[u+1])-(e[u]-e[g])*(e[p+1]-e[u+1]))}return 0===s&&0===d?0:Math.abs((d-s)/s)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[n][o][s]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}},95431:function(e,t,r){r.d(t,{b:function(){return o}});var i=r(4506),n=r(51831);function o(e,t,r){const o=Array.isArray(e),h=o?e.length/t:e.byteLength/(4*t),d=o?e:new Uint32Array(e,0,h*t),u=r?.minReduction??0,g=r?.originalIndices||null,p=g?g.length:0,f=r?.componentOffsets||null;let v=0;if(f)for(let e=0;e<f.length-1;e++){const t=f[e+1]-f[e];t>v&&(v=t)}else v=h;const m=Math.floor(1.1*v)+1;(null==c||c.length<2*m)&&(c=new Uint32Array((0,i.cU)(2*m)));for(let e=0;e<2*m;e++)c[e]=0;let y=0;const _=!!f&&!!g,x=_?p:h;let w=(0,n.my)(h);const C=new Uint32Array(p),b=1.96;let S=0!==u?Math.ceil(4*b*b/(u*u)*u*(1-u)):x,T=1,O=f?f[1]:x;for(let e=0;e<x;e++){if(e===S){const t=1-y/e;if(t+b*Math.sqrt(t*(1-t)/e)<u)return null;S*=2}if(e===O){for(let e=0;e<2*m;e++)c[e]=0;if(g)for(let e=f[T-1];e<f[T];e++)C[e]=w[g[e]];O=f[++T]}const r=_?g[e]:e,i=r*t,n=l(d,i,t);let o=n%m,a=y;for(;0!==c[2*o+1];){if(c[2*o]===n){const e=c[2*o+1]-1;if(s(d,i,e*t,t)){a=w[e];break}}o++,o>=m&&(o-=m)}a===y&&(c[2*o]=n,c[2*o+1]=r+1,y++),w[r]=a}if(0!==u&&1-y/h<u)return null;if(_){for(let e=f[T-1];e<C.length;e++)C[e]=w[g[e]];w=(0,n.Dg)(C)}const R=o?new Array(y):new Uint32Array(y*t);y=0;for(let e=0;e<x;e++)w[e]===y&&(a(d,(_?g[e]:e)*t,R,y*t,t),y++);if(g&&!_){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=w[g[t]];w=(0,n.Dg)(e)}return{buffer:Array.isArray(R)?R:R.buffer,indices:w,uniqueCount:y}}function s(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function a(e,t,r,i,n){for(let o=0;o<n;o++)r[i+o]=e[t+o]}function l(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},63995:function(e,t,r){r.d(t,{S:function(){return l}});var i=r(4506),n=r(5262),o=r(80347),s=r(60929),a=r(87368);function l(e,t,r){const l=function(e,t,r,i){const s=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=i?(0,n.GA)(i)/(0,n.G9)(i):1;return(0,a.lU)(e,((e,t)=>(0,o.i)(e,s(t,0)*l,s(t,1)*l,s(t,2))),r)}(c,e,t,r)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,i.kU)(80))?s._.Z:Math.abs(l[1])>Math.abs(l[0])?s._.Y:s._.X}const c=(0,a.vt)()},30544:function(e,t,r){r.d(t,{Wq:function(){return i},lO:function(){return d},oR:function(){return u}});var i,n=r(91814),o=r(60929),s=r(11021),a=r(75644),l=r(51831),c=r(63995),h=r(95431);function d(e){const t=u(e.rings,e.hasZ,i.CCW_IS_HOLE,e.spatialReference),r=new Array;let o=0,s=0;for(const e of t.polygons){const i=e.count,c=e.index,h=(0,a.l5)(t.position,3*c,3*i),d=e.holeIndices.map((e=>e-c)),u=(0,l.Dg)((0,n.e)(h,d,3));r.push({position:h,faces:u}),o+=h.length,s+=u.length}const c=function(e,t,r){if(1===e.length)return e[0];const i=(0,a.jh)(t),n=new Array(r);let o=0,s=0,c=0;for(const t of e){for(let e=0;e<t.position.length;e++)i[o++]=t.position[e];for(const e of t.faces)n[s++]=e+c;c=o/3}return{position:i,faces:(0,l.Dg)(n)}}(r,o,s),d=Array.isArray(c.position)?(0,h.b)(c.position,3,{originalIndices:c.faces}):(0,h.b)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,a.xm)(new Float64Array(d.buffer)),c.faces=d.indices,c}function u(e,t,r,n){const o=e.length,s=new Array(o),l=new Array(o),c=new Array(o);let h=0;for(let t=0;t<o;++t)h+=e[t].length;let d=0,u=0,f=0;const v=(0,a.jh)(3*h);let m=0;for(let a=o-1;a>=0;a--){const h=e[a],y=r===i.CCW_IS_HOLE&&p(h,t,n);if(y&&1!==o)s[d++]=h;else{let e=h.length;for(let t=0;t<d;++t)e+=s[t].length;const r={index:m,pathLengths:new Array(d+1),count:e,holeIndices:new Array(d)};r.pathLengths[0]=h.length,h.length>0&&(c[f++]={index:m,count:h.length}),m=y?g(h,h.length-1,-1,v,m,h.length,t):g(h,0,1,v,m,h.length,t);for(let e=0;e<d;++e){const i=s[e];r.holeIndices[e]=m,r.pathLengths[e+1]=i.length,i.length>0&&(c[f++]={index:m,count:i.length}),m=g(i,0,1,v,m,i.length,t)}d=0,r.count>0&&(l[u++]=r)}}for(let e=0;e<d;++e){const r=s[e];r.length>0&&(c[f++]={index:m,count:r.length}),m=g(r,0,1,v,m,r.length,t)}return l.length=u,c.length=f,{position:v,polygons:l,outlines:c}}function g(e,t,r,i,n,o,s){n*=3;for(let a=0;a<o;++a){const o=e[t];i[n++]=o[0],i[n++]=o[1],i[n++]=s&&o[2]?o[2]:0,t+=r}return n/3}function p(e,t,r){if(!t)return!(0,s.$3)(e);const i=e.length-1;switch((0,c.S)(e,i,r)){case o._.X:return!(0,s.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,s.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,s.$3)(e,o._.X,o._.Y)}}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(i||(i={}))},91413:function(e,t,r){var i;r.d(t,{$:function(){return i}}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},67175:function(e,t,r){r.d(t,{$4:function(){return _},O0:function(){return x},O1:function(){return w},Sw:function(){return C},eH:function(){return m},rc:function(){return y}});var i=r(44764),n=r(93814),o=r(38116),s=r(91700),a=r(23572),l=r(93611);const c="picture-fill",h="simple-fill",d="simple-line",u="simple-marker",g="text",p="cim",f=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),v=new s.q(1e3);function m(e){const t=e.style;let r=null;if(e)switch(e.type){case u:"cross"!==t&&"x"!==t&&(r=e.color);break;case h:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case c:r={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case g:r=e.color;break;case p:r=(0,l.Nk)(e)}return r}function y(e,t){const r=e+"-"+t;return void 0!==v.get(r)?Promise.resolve(v.get(r)):(0,o.A)(e,{responseType:"image"}).then((e=>{const i=e.data,n=i.naturalWidth,o=i.naturalHeight,s=document.createElement("canvas");s.width=n,s.height=o;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,n,o),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=s.toDataURL();return v.put(r,l),l}))}function _(e){if(!e)return null;let t=null;switch(e.type){case h:case c:case u:t=_(e.outline);break;case d:{const r=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==r&&(t={color:e.color,style:w(e.style),width:r,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=x(t).join(",")||"none");break}default:t=null}return t}function x(e){if(!e?.style)return[];const{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const n=i??0,o=f.has(r)?f.get(r).map((e=>e*n)):[];if("butt"!==e.cap)for(const[e,t]of o.entries())o[e]=e%2==1?t+n:Math.max(t-n,1);return o}const w=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),C=new n.A([128,128,128])},54866:function(e,t,r){r.d(t,{$d:function(){return p},GG:function(){return S},N7:function(){return f},Sx:function(){return v},UQ:function(){return b},di:function(){return T},dt:function(){return y},f3:function(){return O},k_:function(){return g},yG:function(){return R}});var i=r(93814),n=r(3438),o=r(3132),s=(r(6273),r(23572)),a=r(19913),l=r(77498),c=r(93611),h=r(67175),d=r(13665);const u=new i.A("white");function g(e){if(!e)return 0;if((0,n.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,s.PN)((0,h.$4)(e)?.width)}function p(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function f(e){return e.resource?.href??""}function v(e,t){if(!e)return null;let r=null;return(0,n.wk)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)})),r?new i.A(r):null}(e):(0,n.$y)(e)&&(r="cim"===e.type?(0,c.Nk)(e):e.color?new i.A(e.color):null),r?m(r,t):null}function m(e,t){if(null==t||null==e)return e;const r=e.toRgba();return r[3]=r[3]*t,new i.A(r)}function y(e,t,r){e&&(t||null!=r)&&(t&&(t=new i.A(t)),(0,n.wk)(e)?function(e,t,r){const i=e.symbolLayers;if(!i)return;const n=e=>m(t=t??e??(null!=r?u:null),r);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=n(e.color);else{const t=null!=e.material?e.material.color:null,i=n(t);null==e.material?e.material=new d.N({color:i}):e.material.color=i,null!=r&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=m(e.outline.color,r))}}))}(e,t,r):(0,n.$y)(e)&&function(e,t,r){(t=t??e.color)&&(e.color=m(t,r)),null!=r&&"outline"in e&&e.outline?.color&&(e.outline.color=m(e.outline.color,r))}(e,t,r))}async function _(e,t){const i=e.symbolLayers;i&&await(0,o.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=x(t);null!=r&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=w(t,a.Un,[e.width,void 0,e.height]);e.width=C(t[0],e.width,1,r),e.height=C(t[2],e.height,1,r)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:n}=await async function(e){const{computeObjectLayerResourceSize:t}=await r.e(782).then(r.bind(r,8401)),i=await t(e,10),{width:n,height:o,depth:s}=e,a=[n,s,o];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(e),o=w(t,i,n);e.width=C(t[0],n[0],i[0],o),e.depth=C(t[1],n[1],i[1],o),e.height=C(t[2],n[2],i[2],o)}(e,t)}}(e,t)))}function x(e){for(const t of e)if("number"==typeof t)return t;return null}function w(e,t,r){for(let i=0;i<3;i++){const n=e[i];switch(n){case"symbol-value":{const e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}function C(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function b(e,t){if(e&&t)return(0,n.wk)(e)?_(e,t):void((0,n.$y)(e)&&function(e,t){const r=x(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function S(e,t,r){if(e&&null!=t)if((0,n.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if("object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,n.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function T(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function O(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function R(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},47716:function(e,t,r){var i,n;function o(e){return null!=e&&!e.running}r.d(t,{c:function(){return n},pi:function(){return o},tf:function(){return i}}),function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(n||(n={}))},99164:function(e,t,r){r.d(t,{c:function(){return i},n:function(){return f}});var i,n=r(95039),o=r(4506),s=r(39369),a=r(25336),l=r(26110),c=r(80347),h=r(19913),d=r(43785),u=r(99263),g=r(47716),p=r(16120);class f{constructor(){this.startTime=0,this._data=(0,s.v)(null),this._readChannels=g.c.RG,this.parallax=new v,this.parallaxNew=new v,this._anchorPoint=(0,h.vt)(),this._fadeState=(0,s.v)(i.HIDE),this._fadeFactor=(0,s.v)(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case i.HIDE:return 0;case i.FADE_OUT:return 1-this.fadeFactor;case i.FADE_IN:return this.fadeFactor;case i.SHOW:case i.CROSS_FADE:return 1}}fade(e,t,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?(0,o.qE)((t-this.startTime)/(x*r),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(e,t),this._updateParallax(e)}_evaluateState(e,t){const r=e.relativeElevation,n=this._updateAnchorPoint(e);(r>1.7*p.zF||r<-p.zF||n>C)&&this.opacity>0?this._startFade(i.HIDE,t):this.isFading||(r>p.zF||r<-.35*p.zF||n>w*C?this.opacity>0&&this._startFade(i.FADE_OUT,t):(0,g.pi)(this.data)&&(0===this.opacity?this._startFade(i.FADE_IN,t):this.data.state===g.tf.Ready&&(this.fadeState===i.SHOW?this._startFade(i.CROSS_FADE,t):this._startFade(i.SHOW,t))))}_updateParallax(e){const t=(0,c.k)(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(t-u.$O.radius*u.$O.radius,0))/Math.sqrt(t),(0,d.Cr)(m,this.parallax.anchorPoint,y),(0,a.e$)(this.parallax.transform,l.zK,y[3],(0,d.yo)(y)),(0,d.Cr)(m,this.parallaxNew.anchorPoint,y),(0,a.e$)(this.parallaxNew.transform,l.zK,y[3],(0,d.yo)(y))}_updateAnchorPoint(e){return(0,c.n)(this._anchorPoint,e.eye),(0,c.h)(this._anchorPoint,this._anchorPoint,u.$O.radius),this.fadeState===i.HIDE&&this.data?.state===g.tf.Ready?((0,c.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,c.l)((0,c.d)(_,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,t){switch(this._fadeState.value=e,this.startTime=t,e){case i.CROSS_FADE:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_IN:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_OUT:this.requestFade();break;case i.SHOW:this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case i.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==g.tf.Ready&&(this.data.state=g.tf.Idle),this.fadeState){case i.CROSS_FADE:(0,c.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=i.SHOW;break;case i.FADE_IN:this._fadeState.value=i.SHOW;break;case i.FADE_OUT:this._fadeState.value=i.HIDE;break;case i.SHOW:case i.HIDE:break;default:(0,n.Xb)(this.fadeState)}}_switchReadChannels(){this.data?.state===g.tf.Ready&&(this._readChannels=1-this._readChannels,this.data.state=g.tf.Fading)}get isFading(){return this.fadeState===i.FADE_OUT||this.fadeState===i.FADE_IN||this.fadeState===i.CROSS_FADE}}!function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"}(i||(i={}));class v{constructor(){this.anchorPoint=(0,h.vt)(),this.radiusCurvatureCorrection=0,this.transform=(0,l.vt)()}}const m=(0,h.fA)(0,0,1),y=(0,d.vt)(),_=(0,h.vt)(),x=1.25,w=.5,C=2e5},16120:function(e,t,r){r.d(t,{k9:function(){return S},zF:function(){return b}});var i,n=r(82392),o=r(84977),s=r(81482),a=(r(6273),r(80861),r(67498),r(85716)),l=r(26325);let c=i=class extends o.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,n._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const h=c;var d;let u=d=class extends o.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new d({fogStrength:this.fogStrength})}};(0,n._)([(0,a.e)({foggy:"foggy"})],u.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],u.prototype,"fogStrength",void 0),u=d=(0,n._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],u);const g=u;var p;let f=p=class extends o.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new p({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.e)({rainy:"rainy"})],f.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"cloudCover",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"precipitation",void 0),f=p=(0,n._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],f);const v=f;var m;let y=m=class extends o.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new m({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.e)({snowy:"snowy"})],y.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],y.prototype,"cloudCover",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],y.prototype,"precipitation",void 0),(0,n._)([(0,s.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],y.prototype,"snowCover",void 0),y=m=(0,n._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],y);const _=y;var x;let w=x=class extends o.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new x({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({sunny:"sunny"})],w.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"cloudCover",void 0),w=x=(0,n._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],w);const C={key:"type",base:w,typeMap:{sunny:w,cloudy:h,rainy:v,snowy:_,foggy:g}};Object.keys(C.typeMap);const b=1e4,S=1e5},41410:function(e,t,r){r.d(t,{t:function(){return v},z:function(){return _}});var i=r(53334),n=r(56560),o=r(76982),s=r(34670),a=r(99269),l=r(75644),c=r(68435),h=r(51831),d=r(84456),u=r(10941),g=r(61723),p=r(16869),f=r(33763);function v(e,t,r=null){const n=[],v=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,n=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,o=r.length/3-(n?1:0),s=new Array(2*(o-1)),a=n?r.slice(0,-3):r;let l=0;for(let e=0;e<o-1;e++)s[l++]=e,s[l++]=e+1;t.push([f.r.POSITION,new u.n(a,s,3,n)])}(t,n);const _=n[0][1].data,x=n[0][1].indices.length,w=(0,h.EH)(x);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([f.r.COLOR,new u.n(i??o.Un,r,4)])}(t,n,w),function(e,t,r){null==e.attributeData.sizeFeature&&t.push([f.r.SIZE,new u.n([e.attributeData.size??1],r,1,!0)])}(t,n,w),function(e,t,r){e.attributeData.normal&&t.push([f.r.NORMAL,new u.n(e.attributeData.normal,r,3)])}(t,n,w),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([f.r.COLORFEATUREATTRIBUTE,new u.n([e.attributeData.colorFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([f.r.SIZEFEATUREATTRIBUTE,new u.n([e.attributeData.sizeFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([f.r.OPACITYFEATUREATTRIBUTE,new u.n([e.attributeData.opacityFeature],r,1,!0)])}(t,n,w),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==d.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=(0,l.jh)(r.length),o=(0,s.tO)(e.overlayInfo.spatialReference);for(let e=0;e<n.length;e+=3)(0,a.RC)(r,e,n,e,o);const h=r.length/3,g=(0,c.oe)(h+1);let p=m,v=y,_=0,x=0;(0,i.hZ)(p,n[x++],n[x++]),x++,g[0]=0;for(let e=1;e<h+1;++e)e===h&&(x=0),(0,i.hZ)(v,n[x++],n[x++]),x++,_+=(0,i.xg)(p,v),g[e]=_,[p,v]=[v,p];t.push([f.r.DISTANCETOSTART,new u.n(g,t[0][1].indices,1,!0)])}(t,n,_),new p.V(e,n,v,g.X.Line,r)}const m=(0,n.vt)(),y=(0,n.vt)();function _(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const i=e.length,n=(0,l.jh)(3*i);e.forEach(((e,t)=>{n[3*t]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(o)})),r}},86652:function(e,t,r){r.d(t,{A:function(){return c},C:function(){return l}});var i=r(88133),n=r(75644),o=r(30544),s=r(5822),a=r(18428);function l(e,t,r,i){const a="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:d}=(0,o.oR)(l,!!e.hasZ,a,e.spatialReference),u=(0,n.jh)(c.length),g=(0,s.au)(c,e.spatialReference,0,u,0,c,0,c.length/3,t,r,i),p=null!=g;return{lines:p?h(d,c,u):[],projectionSuccess:p,sampledElevation:g}}function c(e,t){const r="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,n="polygon"===e.type?e.rings:e.paths,{position:s,outlines:l}=(0,o.oR)(n,!1,r),c=(0,i.projectBuffer)(s,e.spatialReference,0,s,t,0);for(let e=2;e<s.length;e+=3)s[e]=a.bi;return{lines:c?h(l,s):[],projectionSuccess:c}}function h(e,t,r=null){const i=new Array;for(const{index:o,count:s}of e){if(s<=1)continue;const e=3*o,a=3*s;i.push({position:(0,n.l5)(t,3*o,3*s),mapPositions:null!=r?(0,n.l5)(r,e,a):void 0})}return i}},38952:function(e,t,r){r.d(t,{MQ:function(){return n}});r(30165);var i=r(76388);r(2680);class n extends i.R6{constructor(e,t,r){super(e,t),this.triangleNr=r}}},18428:function(e,t,r){r.d(t,{bi:function(){return Bt}});var i,n=r(82392),o=r(57888),s=r(6273),a=r(80294),l=r(57725),c=r(41785),h=r(61985),d=r(98592),u=r(81482),g=r(80861),p=(r(67498),r(26325)),f=r(25336),v=r(80347),m=r(19913),y=r(161),_=r(31882),x=r(68986),w=r(2532),C=r(96024);class b{constructor(){this._extent=(0,w.vt)(),this.resolution=0,this.renderLocalOrigin=(0,C.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new S}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,-e.range,0,t)}}setupGeometryView(){this.canvasGeometries.numViews=1,(0,w.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class S{constructor(){this.extents=[(0,w.vt)(),(0,w.vt)(),(0,w.vt)()],this.numViews=0}}!function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(i||(i={}));class T{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,l.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,r){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var O=r(38236),R=r(77788),P=r(84618);class D{constructor(e,t,r,i,n=O.N.RGBA_MIPMAP){this.output=r,this.content=i,this.fbo=new T(e,n,t)}get valid(){return this.fbo.valid}}class A{constructor(e){this.targets=[new D(e,"overlay color",R.V.Color,i.Color),new D(e,"overlay IM color",R.V.Color,i.ColorNoRasterImage),new D(e,"overlay highlight",R.V.Highlight,i.Highlight,O.N.RG),new D(e,"overlay water",R.V.Normal,i.WaterNormal),new D(e,"overlay occluded",R.V.Color,i.Occluded)],(0,P.E)()&&this.targets.push(new D(e,"overlay olid",R.V.ObjectAndLayerIdColor,i.ObjectAndLayerIdColor,O.N.RGBA))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var M,I=r(70429),E=r(76982),F=r(83143);F.Zo;!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"}(M||(M={}));r(40574),r(35212),r(60733),r(7792),r(19635);var N,L=r(41014),H=(r(19778),r(7804));!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(N||(N={}));(0,E.vt)();H.n;var z=r(30607),W=r(45845),V=r(53334),G=r(28251),j=r(84586),k=r(21979),U=r(50837),Z=r(47798),q=r(15651);class B extends U.w{constructor(e,t,i){super(e,t,new k.$(Z.H,(()=>r.e(8758).then(r.bind(r,48758)))),i)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var $=r(83350);class Q extends U.w{constructor(e,t,i){super(e,t,new k.$($.a,(()=>r.e(1238).then(r.bind(r,81238)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var Y=r(83882);class X extends L.Y{constructor(){super(...arguments),this.occludedFactor=Y.cD,this.maxHighlightLevel=1,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var K=r(77371);class J extends U.w{constructor(e,t,i){super(e,t,new k.$(K.H,(()=>r.e(3371).then(r.bind(r,13371)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var ee=r(23298);class te extends U.w{constructor(e,t,i){super(e,t,new k.$(ee.S,(()=>r.e(7650).then(r.bind(r,47650)))),i)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var re=r(20527);class ie extends U.w{constructor(e,t,i){super(e,t,new k.$(re.a,(()=>r.e(8415).then(r.bind(r,18415)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var ne=r(10875),oe=r(74242),se=r(33763),ae=r(68716),le=r(67277);const ce=[];new le._(se.r.POSITION,3,ae.pe.FLOAT,0,12),new le._(se.r.POSITION,2,ae.pe.FLOAT,0,8),new le._(se.r.POSITION,2,ae.pe.FLOAT,0,16),new le._(se.r.UV0,2,ae.pe.FLOAT,8,16);var he=r(5801),de=r(89325),ue=r(22497),ge=r(88416);let pe=class extends j.A{constructor(e){super(e),this.produces=G.OG.HIGHLIGHTS,this.consumes={required:[G.OG.HIGHLIGHTS,"highlights"]},this.useMultipleHighlights=!!(0,s.A)("enable-feature:multiple-highlights"),this._optionsTexture=null,this._downsampleDrawParameters=new $.H,this._passParameters=new X,this._singleHighlightBlurDrawParameters=new re.S,this._grid=new fe,e.techniques.precompile(Q),this.useMultipleHighlights?e.techniques.precompile(B):(e.techniques.precompile(J),e.techniques.precompile(ie),e.techniques.precompile(te))}initialize(){this.addHandles([(0,h.wB)((()=>xe(this.view.highlights)),(()=>{this._optionsTexture=(0,l.WD)(this._optionsTexture),this.requestRender(ne.C7.UPDATE)}),h.Vh)])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null),this._grid.coverage=(0,l.Gz)(this._grid.coverage),this._grid.vao=(0,l.WD)(this._grid.vao),this._optionsTexture=(0,l.Gz)(this._optionsTexture)}_updateOptionsTexture(e){const t=this.renderingContext;let r=this._optionsTexture;if(null==r){const e=new ge.R(16,2);e.internalFormat=ae.Ab.RGBA,e.samplingMode=ae.Cj.NEAREST,r=new ue.g(t,e,null),this._optionsTexture=r}r.setData(e),this._passParameters.highlightOptionsTexture=r}render(e){const t=e.find((({name:e})=>e===G.OG.HIGHLIGHTS)),{techniques:r,bindParameters:i,_passParameters:n,renderingContext:o}=this;if(!i.decorations)return t;const s=r.acquire(Q);if(!s.compiled)return s.release(),this.requestRender(ne.C7.UPDATE),t;const a=e.find((({name:e})=>"highlights"===e)).getTexture(),l=()=>{const{highlights:e}=this.view;this._optionsTexture||this._updateOptionsTexture(function(e){const t=new Uint8Array(128),r=(e,r)=>{t[e]=r},i=(e,t)=>{const i=4*e,n=4*e+64,{color:o}=t,s=t.haloColor??o;r(i+0,o.r),r(i+1,o.g),r(i+2,o.b),r(i+3,t.fillOpacity*o.a*255),r(n+0,s.r),r(n+1,s.g),r(n+2,s.b),r(n+3,t.haloOpacity*s.a*255)};return ye(e,((e,t)=>{i(t,e.options)})),t}(e)),n.highlightOptionsTexture=this._optionsTexture,this._gridUpdateResources(a);const t=this._gridComputeCoverage(s,a,i);s.release();const{horizontalCellCount:r,verticalCellCount:o}=t;return n.horizontalCellCount=r,n.verticalCellCount=o,n.coverageTexture=t.coverage?.getTexture(),t},c=e=>{const t=e.verticalCellCount*e.horizontalCellCount;o.bindVAO(e.vao),o.drawElementsInstanced(ae.WR.TRIANGLES,6,ae.pe.UNSIGNED_BYTE,0,t)},{camera:h}=i,d=()=>{o.bindFramebuffer(t.fbo),o.setViewport4fv(h.fullViewport)};return this.useMultipleHighlights?this._renderMultiple(a,l,c,d):this._renderSingle(a,l,c,d),n.highlightTexture=null,n.coverageTexture=null,t}_renderMultiple(e,t,r,i){const{techniques:n,bindParameters:o,_passParameters:s,renderingContext:a}=this,l=n.acquire(B);if(!l.compiled)return l.release(),void this.requestRender(ne.C7.UPDATE);const c=t();s.highlightTexture=e,s.pixelRatio=o.camera.pixelRatio,s.maxHighlightLevel=Ce(this.view.highlights)-1,a.bindTechnique(l,o,s),i(),r(c),l.release()}_renderSingle(e,t,r,i){const{fboCache:n,techniques:o,bindParameters:s,_passParameters:a,renderingContext:l}=this,c=o.acquire(J),h=o.acquire(ie),d=o.acquire(te);if(!d.compiled||!h.compiled||!c.compiled)return d.release(),h.release(),c.release(),void this.requestRender(ne.C7.UPDATE);const u=t(),{width:g,height:p}=e.descriptor;a.maxHighlightLevel=Ce(this.view.highlights)-1,a.highlightTexture=e;const{camera:f}=s,{fullWidth:v,fullHeight:m,pixelRatio:y}=f,_=Math.ceil(v/y),x=Math.ceil(m/y),{_singleHighlightBlurDrawParameters:w}=this;for(let e=0;e<=a.maxHighlightLevel;++e){a.highlightLevel=e,l.setClearColor(0,0,0,0);const t=n.acquire(g,p,"single highlight",O.N.RG);l.bindFramebuffer(t.fbo),l.setViewport(0,0,g,p),l.clear(ae.NV.COLOR),l.bindTechnique(c,s,a),r(u),w.blurInput=t.getTexture(),(0,V.hZ)(w.blurSize,1/_,0);const o=n.acquire(_,x,"single highlight blur h",O.N.RG);l.unbindTexture(o.fbo?.colorTexture),l.bindFramebuffer(o.fbo),l.setViewport(0,0,_,x),l.clear(ae.NV.COLOR),w.blurInput=t.getTexture(),(0,V.hZ)(w.blurSize,1/_,0),l.bindTechnique(h,s,a,w),r(u),t.release(),(0,V.hZ)(w.blurSize,0,1/x),a.singleHighlightBlurTexture=o.getTexture(),i(),l.bindTechnique(d,s,a,w),r(u),o.release()}c.release(),h.release(),d.release()}_gridUpdateResources(e){const t=this.renderingContext,r=this._grid,{width:i,height:n}=e.descriptor;if(r.horizontalCellCount=Math.ceil(i/$.g),r.verticalCellCount=Math.ceil(n/$.g),r.vao)return;const o=de.g.createIndex(t,ae._U.STATIC_DRAW,we);r.vao=new he.Z(t,oe.D,new Map([["geometry",ce]]),new Map([["geometry",de.g.createVertex(t,ae._U.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,t,r){const i=this.renderingContext,n=this._grid,o=t.descriptor,s=Math.ceil(o.width/$.g),a=Math.ceil(o.height/$.g);this._downsampleDrawParameters.input=t,n.coverage?.release();const l=this.fboCache.acquire(s,a,"highlight coverage",O.N.RG);return n.coverage=l,i.bindFramebuffer(l.fbo),i.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,s,a),i.screen.draw(),n}get test(){}};(0,n._)([(0,u.MZ)()],pe.prototype,"produces",void 0),(0,n._)([(0,u.MZ)()],pe.prototype,"consumes",void 0),(0,n._)([(0,u.MZ)({constructOnly:!0})],pe.prototype,"techniques",void 0),pe=(0,n._)([(0,p.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],pe);class fe{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}const ve=new Array(Y.cz),me=new Array(Y.cz);function ye(e,t){const r=Math.min(e.length,Y.cz);let i=Y.cz;for(let t=r-1;t>=0;--t){const r=e.at(t);if(r){const e=r.name;ve.includes(e,i)||(--i,ve[i]=e,me[i]=t)}}const n=Y.cz-i;for(let r=0;r<n;++r){const i=me[Y.cz-n+r];t(e.at(i),r)}}let _e=0;function xe(e){let t=0;const r=Math.min(Y.cz,e.length);for(let i=0;i<r;++i){const r=e.at(i);if(r){const{name:e,options:i}=r;t+=e.length;const{color:n,fillOpacity:o,haloColor:s,haloOpacity:a}=i;t+=n.r+(s?.r??1)+o+a}}{const r=e.at(0);if(r){const{shadowOpacity:e,shadowDifference:i,shadowColor:n}=r.options;t+=e+i+n.r}}return _e+++(t>=0?0:1)}const we=new Uint8Array([0,1,2,2,1,3]);function Ce(e){const t=new Set;for(let r=0;r<Y.cz;++r){const i=e.at(r)?.name;i&&t.add(i)}return t.size}var be=r(13926),Se=r(26421);class Te{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new be.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new Oe(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,l.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&g.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class Oe{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,Se.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var Re,Pe=r(45072),De=r(31272),Ae=r(14692),Me=(r(67900),r(26110)),Ie=r(56560),Ee=r(99164),Fe=r(86316),Ne=r(15449);!function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"}(Re||(Re={}));var Le=r(4477);class He{constructor(e){this.shadowMap=e,this.slot=Ne.N.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Ae.Y.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new I.A,this._inverseViewport=(0,Ie.vt)(),this._oldLighting=new Le.TA,this._newLighting=new Le.TA,this._fadedLighting=new Le.TA,this._lighting=this._newLighting,this.ssr=new ze,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlightMixTexture=null,this.highlightGroupName=null,this.highlightGroupIndices=new Map,this.highlightLevel=0,this.highlightMixOrigin=(0,Ie.vt)(),this.hudRenderStyle=Fe.D.Occluded,this.clouds=new Ee.n,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,r,i){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=r,this._newLighting.set(e),i===Re.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}}class ze{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,Me.vt)()}}class We{constructor(e,t){this.rctx=e,this.lastFrameCamera=new I.A,this.output=R.V.Color,this.renderOccludedMask=Ve,this.bind=new He(t),this.bind.alignPixelEnabled=!0}}const Ve=De.m$.Occlude|De.m$.OccludeAndTransparent|De.m$.OccludeAndTransparentStencil;var Ge=r(4506),je=r(79441),ke=r(74772),Ue=r(84456);let Ze=class extends I.A{constructor(){super(...arguments),this._projectionMatrix=(0,Me.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,n._)([(0,u.MZ)()],Ze.prototype,"_projectionMatrix",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],Ze.prototype,"projectionMatrix",null),Ze=(0,n._)([(0,p.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],Ze);var qe,Be=r(80605);!function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"}(qe||(qe={}));class $e{constructor(){this.camera=new Ze,this.lightMat=(0,Me.vt)()}}class Qe{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ye{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Qe,this._projectionView=(0,Me.vt)(),this._projectionViewInverse=(0,Me.vt)(),this._modelViewLight=(0,Me.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,E.vt)(),this._cascades=[new $e,new $e,new $e,new $e],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,s.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,ke.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,l.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,Ge.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)st[e]=this._cascades[e];return st.length=this._numCascades,st}start(e,t,r,i,n){(0,Se.vA)(this.enabled);const{near:o,far:s}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(o,s,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let e=0;e<this._numCascades;++e)this._constructCascade(e,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,Se.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,v.p)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,m.vt)(),(0,v.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,f.Tl)(at,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)lt[16*t+e]=at[e]}}return lt}moveSnapshot(e){(0,Se.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:r,height:i}=t,n=e===qe.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,i,n,O.N.RGBA4);const o=this._fbos.rctx;this._bindFbo();const s=o.bindTexture(this._snapshots[e]?.getTexture(),ue.g.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(ae.Ap.TEXTURE_2D,0,0,0,0,0,r,i),o.bindTexture(s,ue.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(ae.NV.COLOR|ae.NV.DEPTH)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,Be.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),s=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,Be.uT)(s/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",O.N.RGBA4)),this._handle?.acquireDepth(O.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,l.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,r,i){const n=this._cascades[e],o=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],a=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,Se.vA)(a<l);for(let e=0;e<8;++e){(0,ke.s)(Ke,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?a:l,1);const t=Je[e];(0,ke.t)(t,Ke,this._projectionViewInverse),t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]}(0,v.v)(ot,Je[0]),n.camera.viewMatrix=(0,f.Tl)(Xe,this._modelViewLight,ot);for(let e=0;e<8;++e)(0,v.t)(Je[e],Je[e],n.camera.viewMatrix);let c=Je[0][2],h=Je[0][2];for(let e=1;e<8;++e)c=Math.min(c,Je[e][2]),h=Math.max(h,Je[e][2]);c-=200,h+=200,n.camera.near=-h,n.camera.far=-c,function(e,t,r,i,n){const o=1/Je[0][3],s=1/Je[4][3];(0,Se.vA)(o<s);let a=o+Math.sqrt(o*s);const l=Math.sin((0,Ge.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,r,i,n,o,s,a){(0,V.hZ)(ct,0,0);for(let t=0;t<4;++t)(0,V.WQ)(ct,ct,e[t]);(0,V.hs)(ct,ct,.25),(0,V.hZ)(ht,0,0);for(let t=4;t<8;++t)(0,V.WQ)(ht,ht,e[t]);(0,V.hs)(ht,ht,.25),(0,V.Cc)(dt[0],e[4],e[5],.5),(0,V.Cc)(dt[1],e[5],e[6],.5),(0,V.Cc)(dt[2],e[6],e[7],.5),(0,V.Cc)(dt[3],e[7],e[4],.5);let l=0,c=(0,V.hG)(dt[0],ct);for(let e=1;e<4;++e){const t=(0,V.hG)(dt[e],ct);t<c&&(c=t,l=e)}(0,V.Re)(ut,dt[l],e[l+4]);const h=ut[0];let d,u;ut[0]=-ut[1],ut[1]=h,(0,V.Re)(gt,ht,ct),(0,V.Om)(gt,ut)<0&&(0,V.ze)(ut,ut),(0,V.Cc)(ut,ut,gt,r),(0,V.S8)(ut,ut),d=u=(0,V.Om)((0,V.Re)(pt,e[0],ct),ut);for(let t=1;t<8;++t){const r=(0,V.Om)((0,V.Re)(pt,e[t],ct),ut);r<d?d=r:r>u&&(u=r)}(0,V.C)(i,ct),(0,V.hs)(pt,ut,d-t),(0,V.WQ)(i,i,pt);let g=-1,p=1,f=0,v=0;for(let t=0;t<8;++t){(0,V.Re)(ft,e[t],i),(0,V.S8)(ft,ft);const r=ut[0]*ft[1]-ut[1]*ft[0];r>0?r>g&&(g=r,f=t):r<p&&(p=r,v=t)}(0,Se.MX)(g>0,"leftArea"),(0,Se.MX)(p<0,"rightArea"),(0,V.hs)(vt,ut,d),(0,V.WQ)(vt,vt,ct),(0,V.hs)(mt,ut,u),(0,V.WQ)(mt,mt,ct),yt[0]=-ut[1],yt[1]=ut[0];const m=(0,Se.L)(i,e[v],mt,(0,V.WQ)(pt,mt,yt),1,n),y=(0,Se.L)(i,e[f],mt,pt,1,o),_=(0,Se.L)(i,e[f],vt,(0,V.WQ)(pt,vt,yt),1,s),x=(0,Se.L)(i,e[v],vt,pt,1,a);(0,Se.MX)(m,"rayRay"),(0,Se.MX)(y,"rayRay"),(0,Se.MX)(_,"rayRay"),(0,Se.MX)(x,"rayRay")}(Je,a,l,et,tt,rt,it,nt),function(e,t,r,i,n){(0,V.Re)(Ct,r,i),(0,V.hs)(Ct,Ct,.5),bt[0]=Ct[0],bt[1]=Ct[1],bt[2]=0,bt[3]=Ct[1],bt[4]=-Ct[0],bt[5]=0,bt[6]=Ct[0]*Ct[0]+Ct[1]*Ct[1],bt[7]=Ct[0]*Ct[1]-Ct[1]*Ct[0],bt[8]=1,bt[_t(0,2)]=-(0,V.Om)(wt(bt,0),e),bt[_t(1,2)]=-(0,V.Om)(wt(bt,1),e);let o=(0,V.Om)(wt(bt,0),r)+bt[_t(0,2)],s=(0,V.Om)(wt(bt,1),r)+bt[_t(1,2)],a=(0,V.Om)(wt(bt,0),i)+bt[_t(0,2)],l=(0,V.Om)(wt(bt,1),i)+bt[_t(1,2)];o=-(o+a)/(s+l),bt[_t(0,0)]+=bt[_t(1,0)]*o,bt[_t(0,1)]+=bt[_t(1,1)]*o,bt[_t(0,2)]+=bt[_t(1,2)]*o,o=1/((0,V.Om)(wt(bt,0),r)+bt[_t(0,2)]),s=1/((0,V.Om)(wt(bt,1),r)+bt[_t(1,2)]),bt[_t(0,0)]*=o,bt[_t(0,1)]*=o,bt[_t(0,2)]*=o,bt[_t(1,0)]*=s,bt[_t(1,1)]*=s,bt[_t(1,2)]*=s,bt[_t(2,0)]=bt[_t(1,0)],bt[_t(2,1)]=bt[_t(1,1)],bt[_t(2,2)]=bt[_t(1,2)],bt[_t(1,2)]+=1,o=(0,V.Om)(wt(bt,1),t)+bt[_t(1,2)],s=(0,V.Om)(wt(bt,2),t)+bt[_t(2,2)],a=(0,V.Om)(wt(bt,1),r)+bt[_t(1,2)],l=(0,V.Om)(wt(bt,2),r)+bt[_t(2,2)],o=-.5*(o/s+a/l),bt[_t(1,0)]+=bt[_t(2,0)]*o,bt[_t(1,1)]+=bt[_t(2,1)]*o,bt[_t(1,2)]+=bt[_t(2,2)]*o,o=(0,V.Om)(wt(bt,1),t)+bt[_t(1,2)],s=(0,V.Om)(wt(bt,2),t)+bt[_t(2,2)],a=-s/o,bt[_t(1,0)]*=a,bt[_t(1,1)]*=a,bt[_t(1,2)]*=a,n[0]=bt[0],n[1]=bt[1],n[2]=0,n[3]=bt[2],n[4]=bt[3],n[5]=bt[4],n[6]=0,n[7]=bt[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=bt[6],n[13]=bt[7],n[14]=0,n[15]=bt[8]}(et,tt,it,nt,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,c,h,n.camera),(0,f.lw)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const d=this._textureHeight;n.camera.viewport=[e*d,0,d,d]}_setupMatrices(e,t){(0,f.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,f.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Ue.RT.Global?e.eye:(0,v.i)(ot,0,0,1);(0,f.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,Se.kL)(t/e,4)),i);const n=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let s=e,a=e;for(let e=0;e<this._numCascades+1;++e)this._cascadeDistances[e]=(0,Ge.Cc)(s,a,this.settings.splitSchemeLambda),s*=o,a+=n}get test(){}}const Xe=(0,Me.vt)(),Ke=(0,E.vt)(),Je=[];for(let e=0;e<8;++e)Je.push((0,E.vt)());const et=(0,Ie.vt)(),tt=(0,Ie.vt)(),rt=(0,Ie.vt)(),it=(0,Ie.vt)(),nt=(0,Ie.vt)(),ot=(0,m.vt)(),st=[],at=(0,Me.vt)(),lt=Me.zK.concat(Me.zK,Me.zK,Me.zK,Me.zK),ct=(0,Ie.vt)(),ht=(0,Ie.vt)(),dt=[(0,Ie.vt)(),(0,Ie.vt)(),(0,Ie.vt)(),(0,Ie.vt)()],ut=(0,Ie.vt)(),gt=(0,Ie.vt)(),pt=(0,Ie.vt)(),ft=(0,Ie.vt)(),vt=(0,Ie.vt)(),mt=(0,Ie.vt)(),yt=(0,Ie.vt)();function _t(e,t){return 3*t+e}const xt=(0,Ie.vt)();function wt(e,t){return(0,V.hZ)(xt,e[t],e[t+3]),xt}const Ct=(0,Ie.vt)(),bt=(0,je.vt)();var St=r(73783),Tt=r(3800),Ot=r(38952),Rt=r(63597),Pt=r(57809),Dt=r(30165),At=r(80561),Mt=r(14017),It=r(75124);let Et=class extends St.A{constructor(e){super(e),this._pending=new Ft,this._changes=new Rt.VR,this._renderers=new Map,this._sortedRenderers=new c.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(0!==e.numGeometries&&!e.queryRenderOccludedState(De.m$.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&0===this._renderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,Mt.$T)(this._changes);let t=!1;return e.forEach(((e,r)=>{let i=this._renderers.get(r);!i&&e.adds.length>0&&(i=new It.y({material:r}),i.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(r,i),t=!0),i&&(i.modify(e),0===i.numGeometries&&(this._renderers.delete(r),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,a.Bs)(this._renderers,(e=>{const t=e.produces.get(Ne.N.DRAPED_MATERIAL);return!!t&&t(R.V.Highlight)})),this._hasWater=(0,a.Bs)(this._renderers,(e=>{const t=e.produces.get(Ne.N.DRAPED_WATER);return!!t&&t(R.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const e of r)this._geometries.set(e.id,e);const i=this._pending.empty;for(const e of r)this._pending.adds.add(e);i&&this.notifyChange("updating"),t===At.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const t of e)i.has(t)?(this._pending.removed.add(t),i.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete(t.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===At.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case At.k.TRANSFORMATION:case At.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case At.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}precompile(e){return this._sortedRenderers.reduce(((t,r)=>r.precompile(e)||t),!1)}render(e){this._sortedRenderers.forAll((t=>{const r=t.acquireTechniques(e);r&&(t.render(e,r),(0,W.VM)(r))}))}intersect(e,t,r,i,n){for(const o of this._geometries.values()){if(!i(o))continue;this._intersectRenderGeometry(o,r,t,0,e,n);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,r,t,s.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,r,t,-s.range,e,n)),n++}return n}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const t of this._renderers.values())t.drapedPriority=e++,this._sortedRenderers.push(t);this._sortedRenderers.sort(((e,t)=>t.material?.renderPriority===e.material?.renderPriority?e.drapedPriority-t.drapedPriority:(t.material?.renderPriority||0)-(e.material?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace((({renderGeometry:e})=>!this._pending.has(e))),this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,o){if(!e.visible||!e.material.visible)return;let s=0;i+=e.transformation[12],s=e.transformation[13],Nt[0]=r[0]-i,Nt[1]=r[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Nt,((r,i,s)=>{!function(e,t,r,i,n,o,s){const a=new Ot.MQ(o,s,t),l=t=>{t.set(Dt.dz.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Dt.oH.MIN&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Dt.oH.ALL){const e=(0,Pt.G7)(n.ray);l(e),n.results.all.push(e)}}(t,s,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const{graphicUid:r}of e)null!=r&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const{graphicUid:r}of e)null!=r&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,Tt.a)(e.boundingSphere))),e}get test(){}};(0,n._)([(0,u.MZ)()],Et.prototype,"drapeSource",void 0),(0,n._)([(0,u.MZ)()],Et.prototype,"updating",null),(0,n._)([(0,u.MZ)()],Et.prototype,"rctx",null),(0,n._)([(0,u.MZ)({constructOnly:!0})],Et.prototype,"rendererContext",void 0),(0,n._)([(0,u.MZ)()],Et.prototype,"_materials",null),(0,n._)([(0,u.MZ)()],Et.prototype,"_localOriginFactory",null),(0,n._)([(0,u.MZ)({readOnly:!0})],Et.prototype,"isEmpty",null),(0,n._)([(0,u.MZ)()],Et.prototype,"_renderers",void 0),(0,n._)([(0,u.MZ)()],Et.prototype,"_geometries",void 0),Et=(0,n._)([(0,p.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Et);class Ft{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Nt=(0,Ie.vt)();class Lt extends U.w{constructor(e,t,i){super(e,t,new k.$(z.a,(()=>r.e(5510).then(r.bind(r,5510)))),i)}initializePipeline(e){return e.hasAlpha?(0,q.Ey)({blending:q.Ky,colorWrite:q.kn}):(0,q.Ey)({colorWrite:q.kn})}}var Ht=r(67069);class zt extends Ht.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,n._)([(0,Ht.W)()],zt.prototype,"hasAlpha",void 0);var Wt=r(34402),Vt=r(50162),Gt=r(58062);class jt extends U.w{constructor(e,t,i){super(e,t,new k.$(Gt.a,(()=>r.e(6174).then(r.bind(r,76174)))),i)}}var kt=r(49437);let Ut=class extends W.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Gt.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new c.A,this._passParameters=new z.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new I.A,this.worldToPCSRatio=1,this.events=new o.A,this.longitudeCyclical=null,this.produces=new Map([[Ne.N.DRAPED_MATERIAL,e=>e!==R.V.Highlight||this.hasHighlights],[Ne.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const{view:e}=this,{_stage:t}=e,r=t.renderer.fboCache,i=t.renderView,{waterTextures:n,textures:o}=i;this._renderContext=new We(this._rctx,new Ye(r,e.state.viewingMode)),this.addHandles([(0,h.wB)((()=>n.updating),(()=>this.events.emit("content-changed")),h.pc),(0,h.wB)((()=>this.spatialReference),(e=>this._localOriginFactory=new Pe.g(e)),h.pc),(0,h.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,h.wB)((()=>xe(this.view.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),h.pc)]),this._materials=new Te(o,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));const{_bindParameters:s,_camera:a}=this;s.slot=Ne.N.DRAPED_MATERIAL,s.mainDepth=null,a.near=1,a.far=1e4,a.relativeElevation=null,s.camera=this._camera,s.oitPass=Ae.Y.NONE,s.updateLighting([new Vt.$p((0,m.S)())],0,0,Re.Immediate),this.addHandles(this.view.resourceController.scheduler.registerTask(kt.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._passParameters.texture=(0,l.WD)(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(jt)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,a.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Et)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,h.wB)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(e,(e=>e.drapeTargetType===y.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(e,(e=>e.drapeSourceType===y.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(e,(e=>e.drapeSourceType===y.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new A(this.view._stage.renderer.fboCache),this._overlays=[new b,new b]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,l.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(i.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,a.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(kt.Bb,(e=>e.updatePolicy===Wt.q.SYNC))}get isEmpty(){return!_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,a.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=$t,++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==i.Occluded&&e!==i.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,t}get mode(){return this.isEmpty?N.Disabled:this._renderTargets?.getTexture(i.WaterNormal)?N.EnabledWithWater:this._renderTargets?.getTexture(i.Color)?N.Enabled:N.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,this._bindParameters.highlightGroupName=null,++this._techniques.precompiling;for(const e of this._renderTargets.targets){if(e.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=e.output;this._renderContext.output=t,this._bindParameters.slot=t===R.V.Normal?Ne.N.DRAPED_WATER:Ne.N.DRAPED_MATERIAL,e.content===i.Occluded&&(this._renderContext.renderOccludedMask=$t),this._sortedRenderers.forAll((({drapeSource:t,renderer:r})=>{e.content===i.ColorNoRasterImage&&t.drapeSourceType===y.Om.RasterImage||r.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=Ve}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(x.vr.INNER,t,e),n=this._drawTarget(x.vr.OUTER,t,e);(r||n)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const n=this._overlays[e],o=n.canvasGeometries;if(0===o.numViews)return!1;const{contentPixelRatio:s}=r;this._screenToWorldRatio=s*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===R.V.Normal&&!this.hasWater||!n.hasSomeSizedView())return!1;const{_rctx:l,_bindParameters:c}=this;if(this._camera.pixelRatio=n.pixelRatio*s,this._renderContext.output=a,c.screenToWorldRatio=this._screenToWorldRatio,c.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,c.slot=a===R.V.Normal?Ne.N.DRAPED_WATER:Ne.N.DRAPED_MATERIAL,t.content===i.Occluded&&(this._renderContext.renderOccludedMask=$t),c.highlightGroupName=null,!this.renders(t.content))return this._renderContext.renderOccludedMask=Ve,!1;const{resolution:h}=n,d=e===x.vr.INNER?0:h;if(l.setViewport(d,0,h,h),this._bindTargetFBO(t),e===x.vr.INNER&&(l.setClearColor(0,0,0,0),l.clear(ae.NV.COLOR)),_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==i.Occluded&&t.content!==i.Highlight){this._techniques.precompile(Lt,Qt);const t=this._techniques.acquire(Lt,Qt);for(let r=0;r<o.numViews;r++)this._setViewParameters(o.extents[r],n),this._ensureDebugPatternResources(n.resolution,qt[e]),l.bindTechnique(t,c,this._passParameters),l.screen.draw();t.release()}if(t.output===R.V.Highlight){const{fboCache:r}=this.view._stage.renderer,i=this._resolution;!function(e,t,r,i,n,o,s=0,a){const{highlightGroupIndices:l}=n;l.clear();const c=[];ye(i,(e=>{const{name:t}=e;l.set(t,c.length),c.push(t)}));const h=l.size,{gl:d}=e;(0,V.hZ)(n.highlightMixOrigin,s,0);let u=null;h>1&&(u=t.acquire(r.width,r.height,"highlight mix",O.N.RG),e.bindFramebuffer(u.fbo),e.clearFramebuffer(E.uY));const g=u?.getTexture()??null;n.highlightMixTexture=g,a();for(let t=0;t<h;++t)t>0&&(e.bindTexture(g,0),d.copyTexSubImage2D(ae.Ap.TEXTURE_2D,0,0,0,s,0,r.width,r.height),e.bindTexture(null,0)),e.clear(ae.NV.DEPTH),n.highlightLevel=t,n.highlightGroupName=c[t],o();u?.release()}(l,r,{width:i,height:i},this.view.highlights,c,(()=>this._renderAllGeometry(e,t)),d,(()=>this._bindTargetFBO(t)))}else this._renderAllGeometry(e,t);return l.bindFramebuffer(null),this._renderContext.renderOccludedMask=Ve,!0}_renderAllGeometry(e,t){const r=this._overlays[e],n=r.canvasGeometries;this._sortedRenderers.forAll((({drapeSource:o,renderer:s})=>{if(t.content===i.ColorNoRasterImage&&o.drapeSourceType===y.Om.RasterImage)return;const{fullOpacity:a}=o,l=null!=a&&a<1&&t.output===R.V.Color&&this._bindTemporaryFBO();for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],r),s.render(this._renderContext);if(l){this._bindTargetFBO(t),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const r=this._techniques.acquire(jt);this._rctx.bindTechnique(r,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),r.release(),l.release()}}))}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.bind(this._rctx,r,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this.view._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(ae.NV.COLOR),i}get _resolution(){return this._overlays?.[x.vr.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:o}of this._sortedRenderers)n=o.intersect?.(e,t,r,i,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{const n=e.indexOf(i.layer),o=n>=0,s=i.renderGroup??(o?y.O7.MapLayer:y.O7.ViewLayer),a=t*s+(o?n:0);this._sortedRenderers.push(new Zt(i,r,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,f.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,f.kN)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,a.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water"))}_ensureDebugPatternResources(e,t){if((0,v.i)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let t=0;t<e;t++)for(let n=0;n<e;n++){const o=Math.floor(n/10),s=Math.floor(t/10);o<2||s<2||10*o>e-20||10*s>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&s?1&n^1&t?0:255:1&o^1&s?0:128)}const n=new ge.R(e);n.samplingMode=ae.Cj.NEAREST,this._passParameters.texture=new ue.g(this._rctx,n,r)}get test(){}};(0,n._)([(0,u.MZ)()],Ut.prototype,"hasHighlights",void 0),(0,n._)([(0,u.MZ)()],Ut.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,n._)([(0,u.MZ)({constructOnly:!0})],Ut.prototype,"view",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],Ut.prototype,"_techniques",null),(0,n._)([(0,u.MZ)()],Ut.prototype,"worldToPCSRatio",void 0),(0,n._)([(0,u.MZ)()],Ut.prototype,"spatialReference",void 0),(0,n._)([(0,u.MZ)({type:Boolean,readOnly:!0})],Ut.prototype,"updating",null),(0,n._)([(0,u.MZ)()],Ut.prototype,"isEmpty",null),(0,n._)([(0,u.MZ)({readOnly:!0})],Ut.prototype,"rendersOccludedDraped",null),Ut=(0,n._)([(0,p.$)("esri.views.3d.terrain.OverlayRenderer")],Ut);class Zt{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const qt=[[1,.5,.5],[.5,.5,1]],Bt=-2,$t=De.m$.OccludeAndTransparent,Qt=new zt;Qt.hasAlpha=!0},68986:function(e,t,r){var i,n,o;r.d(t,{vr:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},51269:function(e,t,r){r.d(t,{Q:function(){return a}});var i=r(25523),n=r(41014),o=r(19778),s=r(83350);function a(e){const{vertex:t}=e;t.uniforms.add(new o.N("coverageTexture",(e=>e.coverageTexture)),new i.g("highlightRenderCellCount",(e=>[e.horizontalCellCount,e.verticalCellCount])),new i.g("highlightTextureResolution",(e=>[e.highlightTexture.descriptor.width,e.highlightTexture.descriptor.height]))),t.constants.add("cellSize","int",s.g),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(n.H`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),t.main.add(n.H`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}},88351:function(e,t,r){r.d(t,{y:function(){return n}});var i=r(41014);function n(e){const{fragment:t}=e;t.code.add(i.H`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},38596:function(e,t,r){r.d(t,{v:function(){return o},z:function(){return n}});var i=r(41014);function n(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function o(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},60733:function(e,t,r){r.d(t,{E:function(){return P}});var i=r(38596),n=r(41014);function o(e){e.fragment.code.add(n.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var s=r(75762),a=r(60060),l=r(16937),c=r(66579),h=r(19635),d=r(99040),u=r(19778);function g(e,t){if(!t.screenSpaceReflections)return;const r=e.fragment;r.include(l.E),r.uniforms.add(new c.G("nearFar",((e,t)=>t.camera.nearFar)),new u.N("depthMap",((e,t)=>t.depth?.attachment)),new d.X("proj",((e,t)=>t.camera.projectionMatrix)),new h.m("invResolutionHeight",((e,t)=>1/t.camera.height)),new d.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))).code.add(n.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var p=r(19913),f=r(99263),v=r(47716),m=r(99164),y=r(16120),_=r(40574),x=r(27981),w=r(64802),C=r(7804),b=r(34088);class S extends C.n{constructor(e,t){super(e,"samplerCube",b.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}function T(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",O).code.add(n.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new h.m("radiusCurvatureCorrection",((e,t)=>t.clouds.parallax.radiusCurvatureCorrection))).code.add(n.H`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(n.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,_.Gc)(t),(0,_.O4)(t);const r=(0,p.fA)(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",r);t.code.add(n.H`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${n.H.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${n.H.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${n.H.float(.2)} * pow(dirDotLight, ${n.H.float(10)}) * (1. - pow(sunsetTransition, ${n.H.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new x.e("readChannelsRG",((e,t)=>t.clouds.readChannels===v.c.RG)),new S("cubeMap",((e,t)=>t.clouds.data?.cubeMap?.colorTexture??null))).code.add(n.H`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new w.t("anchorPoint",((e,t)=>t.clouds.parallax.anchorPoint)),new w.t("anchorPointNew",((e,t)=>t.clouds.parallaxNew.anchorPoint)),new d.X("rotationClouds",((e,t)=>t.clouds.parallax.transform)),new d.X("rotationCloudsNew",((e,t)=>t.clouds.parallaxNew.transform)),new h.m("cloudsOpacity",((e,t)=>t.clouds.opacity)),new h.m("fadeFactor",((e,t)=>t.clouds.fadeFactor)),new x.e("crossFade",((e,t)=>t.clouds.fadeState===m.c.CROSS_FADE))).code.add(n.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const O=(f.$O.radius+y.k9)**2;function R(e){e.code.add(n.H`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function P(e,t){e.include(s.f,t),e.include(o),e.include(i.v),t.cloudReflections&&e.include(T),e.include(g,t);const r=e.fragment;r.include(R),r.constants.add("fresnelSky","vec3",[.02,1,15]),r.constants.add("fresnelMaterial","vec2",[.02,.1]),r.constants.add("roughness","float",.015),r.constants.add("foamIntensityExternal","float",1.7),r.constants.add("ssrIntensity","float",.65),r.constants.add("ssrHeightFadeStart","float",a.O),r.constants.add("ssrHeightFadeEnd","float",a.b),r.constants.add("waterDiffusion","float",.92),r.constants.add("waterSeaColorMod","float",.8),r.constants.add("correctionViewingPowerFactor","float",.4),r.constants.add("skyZenitColor","vec3",[.52,.68,.9]),r.constants.add("skyColor","vec3",[.67,.79,.9]),r.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(n.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new h.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add(n.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.cloudReflections&&r.uniforms.add(new h.m("cloudsOpacity",((e,t)=>t.clouds.opacity))).code.add(n.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),t.screenSpaceReflections?r.uniforms.add(new d.X("view",((e,t)=>t.camera.viewMatrix)),new u.N("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColor?.getTexture())),new h.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))).code.add(n.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):r.code.add(n.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.cloudReflections?t.screenSpaceReflections?r.code.add(n.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(n.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(n.H`return waterRenderedColor;
}`)}},35537:function(e,t,r){r.d(t,{$:function(){return c}});var i=r(78851),n=r(25336),o=r(26110),s=r(80347),a=r(3800),l=r(45773);class c{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,o.vt)(),(0,n.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,s.t)((0,a.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(e){this.geometry.foreachHighlightGroup(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},29239:function(e,t,r){r.d(t,{v:function(){return M}});var i=r(76982),n=r(7724),o=r(77788),s=r(78546),a=r(84618),l=r(10875),c=r(76687),h=r(8445),d=r(15449),u=r(33763),g=r(66356),p=r(81996),f=r(34383),v=r(21979),m=r(50837),y=r(14692),_=r(28116),x=r(38382),w=r(68716),C=r(15651);f.S;class b extends m.w{constructor(e,t,i){super(e,t,new v.$(x.C,(()=>r.e(5918).then(r.bind(r,55918)))),i)}_createPipeline(e,t){const{oitPass:r,output:i,transparent:n,cullFace:s,draped:a,hasOccludees:l,polygonOffset:c,enableOffset:d}=e,u=r===y.Y.NONE,g=r===y.Y.FrontFace;return(0,C.Ey)({blending:i===o.V.Color&&n?(0,h.Yf)(r):null,culling:(0,C.Xt)(s),depthTest:a?null:{func:(0,h.K_)(r)},depthWrite:(0,h.z5)(e),drawBuffers:i===o.V.Depth?{buffers:[w.Hr.NONE]}:(0,h.m6)(r,i),colorWrite:C.kn,stencilWrite:l?_.v0:null,stencilTest:l?t?_.a9:_.qh:null,polygonOffset:u||g?c?S:null:(0,h.aB)(d)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const S={factor:1,units:1};var T=r(82392),O=r(51229),R=r(6750),P=r(67069),D=r(12013);class A extends D.E{constructor(){super(...arguments),this.cullFace=l.s2.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=O.I.None,this.emissionSource=R.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}(0,T._)([(0,P.W)({count:l.s2.COUNT})],A.prototype,"cullFace",void 0),(0,T._)([(0,P.W)()],A.prototype,"hasSlicePlane",void 0),(0,T._)([(0,P.W)()],A.prototype,"hasVertexColors",void 0),(0,T._)([(0,P.W)()],A.prototype,"transparent",void 0),(0,T._)([(0,P.W)()],A.prototype,"discardInvisibleFragments",void 0),(0,T._)([(0,P.W)()],A.prototype,"polygonOffset",void 0),(0,T._)([(0,P.W)()],A.prototype,"enableOffset",void 0),(0,T._)([(0,P.W)()],A.prototype,"writeDepth",void 0),(0,T._)([(0,P.W)()],A.prototype,"hasOccludees",void 0),(0,T._)([(0,P.W)()],A.prototype,"terrainDepthTest",void 0),(0,T._)([(0,P.W)()],A.prototype,"cullAboveTerrain",void 0),(0,T._)([(0,P.W)()],A.prototype,"objectAndLayerIdColorInstanced",void 0),(0,T._)([(0,P.W)()],A.prototype,"vvColor",void 0),(0,T._)([(0,P.W)()],A.prototype,"draped",void 0);class M extends p.W{constructor(e){super(e,E),this._configuration=new A,this.supportsEdges=!0,this.produces=new Map([[d.N.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[d.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[d.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._transparent&&this.parameters.writeDepth],[d.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>(0,o.eh)(e)&&this._transparent&&this.parameters.writeDepth],[d.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,o.zW)(e)&&this._transparent&&!this.parameters.writeDepth],[d.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<h.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=s.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===o.V.Highlight||(0,o.zW)(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return(0,o.eh)(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new I(e)}createBufferWriter(){const e=(0,n.BP)().vec3f(u.r.POSITION);return(0,a.E)()&&e.vec4u8(u.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(u.r.COLORFEATUREATTRIBUTE):e.vec4u8(u.r.COLOR),new g.Z(e)}}class I extends c.A{beginSlot(e){return this.acquireTechnique(b,e)}}class E extends f.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.s2.None,this.draped=!1,this.discardInvisibleFragments=!1}}},83938:function(e,t,r){r.d(t,{Ci:function(){return o},Dq:function(){return l},dB:function(){return a},zK:function(){return s}});var i=r(7724),n=r(33763);const o=(0,i.BP)().vec3f(n.r.POSITION),s=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0),a=(0,i.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OBJECTANDLAYERIDCOLOR)},81996:function(e,t,r){r.d(t,{W:function(){return o}});var i=r(31272),n=r(17555);class o extends i.im{intersect(e,t,r,i,o,s){return(0,n.Uy)(e,r,i,o,void 0,s)}}},51310:function(e,t,r){r.d(t,{Xq:function(){return a},wk:function(){return s}});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},o=8;function s(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return"style"===e?.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(n[e],o):null}(e.style):null}}}]);
//# sourceMappingURL=2332.8938994711f54123ad1a.js.map