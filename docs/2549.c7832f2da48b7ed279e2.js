"use strict";(self.webpackChunkreact_redux_arcgis_boilerplate=self.webpackChunkreact_redux_arcgis_boilerplate||[]).push([[2549],{97881:function(e,t,i){i.d(t,{A:function(){return h}});var r=i(47111),s=i(73027);class h{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let r=this._inFlightResourceMap.get(e);return r?r.then((e=>({width:e.width,height:e.height}))):(r=(0,s.M5)(e,t),this._inFlightResourceMap.set(e,r),r.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,r.Al)(e)}}},22549:function(e,t,i){i.r(t),i.d(t,{CIMSymbolRasterizer:function(){return l}});var r=i(97881),s=i(13788),h=i(52644),n=i(9427),a=i(77234);const c=96/72;class l{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,r,s,c,l,u,g){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;c||(c=(0,a.n5)(y));const w=await n.$.resolveSymbolOverrides(d,t,this._spatialReference,s,c,l,u),m=this._cimResourceManager,p=[];h.wp.fetchResources(w,m,p),h.wp.fetchFonts(w,m,p),p.length>0&&await Promise.all(p);const{width:M,height:_}=i,R=o(c,M,_,r),b=h.wp.getEnvelope(w,R,m);if(!b)return null;b.x===1/0&&(b.x=M+2),b.y===1/0&&(b.y=-_/2),b.width===-1/0&&(b.width=M),b.height===-1/0&&(b.height=_);let f=1,C=0,v=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;b.width>M&&(e=M/b.width);let t=1;b.height>_&&(t=_/b.height),"preview"===r&&(b.width<M&&(e=M/b.width),b.height<_&&(t=_/b.height)),f=Math.min(e,t),C=b.x+b.width/2,v=b.y+b.height/2}break;case"CIMLineSymbol":{(g||b.height>_)&&(f=_/b.height),v=b.y+b.height/2;const e=b.x*f+M/2,t=(b.x+b.width)*f+M/2,{paths:i}=R;i[0][0][0]-=e/f,i[0][2][0]-=(t-M)/f}break;case"CIMPolygonSymbol":{C=b.x+b.width/2,v=b.y+b.height/2;const e=b.x*f+M/2,t=(b.x+b.width)*f+M/2,i=b.y*f+_/2,r=(b.y+b.height)*f+_/2,{rings:s}=R;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>M&&(s[0][1][0]-=t-M,s[0][2][0]-=t-M),r>_&&(s[0][2][1]+=r-_,s[0][3][1]+=r-_)}}const x={type:"cim",data:{type:"CIMSymbolReference",symbol:w}};return this.rasterize(x,M,_,C,v,f,c,1,R)}rasterize(e,t,i,r,h,n,l,u=0,g=null){const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d,w=this._canvas,m=(window.devicePixelRatio||1)*c;w.width=t*m,w.height=i*m,l||(l=(0,a.n5)(y)),g||(g=o(l,t,i,"legend")),w.width+=2*u,w.height+=2*u;const p=w.getContext("2d",{willReadFrequently:!0}),M=s.IT.createIdentity();return M.translate(-r,-h),M.scale(n*m,-n*m),M.translate(t*m/2+u,i*m/2+u),p.clearRect(0,0,w.width,w.height),new s.Rj(p,this._cimResourceManager,M,!0).drawSymbol(y,g),p.getImageData(0,0,w.width,w.height)}}function o(e,t,i,r){const s=-t/2+1,h=t/2-1,n=i/2-1,a=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[s,0],[0,0],[h,0]]]};default:return"legend"===r?{rings:[[[s,n],[h,0],[h,a],[s,a],[s,n]]]}:{rings:[[[s,n],[h,n],[h,a],[s,a],[s,n]]]}}}}}]);
//# sourceMappingURL=2549.c7832f2da48b7ed279e2.js.map