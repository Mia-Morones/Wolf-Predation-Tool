"use strict";(self.webpackChunkreact_redux_arcgis_boilerplate=self.webpackChunkreact_redux_arcgis_boilerplate||[]).push([[2549,4974],{97881:function(e,t,i){i.d(t,{A:function(){return r}});var n=i(47111),h=i(73027);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let n=this._inFlightResourceMap.get(e);return n?n.then((e=>({width:e.width,height:e.height}))):(n=(0,h.M5)(e,t),this._inFlightResourceMap.set(e,n),n.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,n.Al)(e)}}},22549:function(e,t,i){i.r(t),i.d(t,{CIMSymbolRasterizer:function(){return c}});var n=i(97881),h=i(13788),r=i(52644),s=i(9427),a=i(77234);const l=96/72;class c{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new n.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,h,l,c,u,g){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;l||(l=(0,a.n5)(y));const m=await s.$.resolveSymbolOverrides(d,t,this._spatialReference,h,l,c,u),f=this._cimResourceManager,w=[];r.wp.fetchResources(m,f,w),r.wp.fetchFonts(m,f,w),w.length>0&&await Promise.all(w);const{width:p,height:M}=i,b=o(l,p,M,n),x=r.wp.getEnvelope(m,b,f);if(!x)return null;x.x===1/0&&(x.x=p+2),x.y===1/0&&(x.y=-M/2),x.width===-1/0&&(x.width=p),x.height===-1/0&&(x.height=M);let _=1,v=0,R=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;x.width>p&&(e=p/x.width);let t=1;x.height>M&&(t=M/x.height),"preview"===n&&(x.width<p&&(e=p/x.width),x.height<M&&(t=M/x.height)),_=Math.min(e,t),v=x.x+x.width/2,R=x.y+x.height/2}break;case"CIMLineSymbol":{(g||x.height>M)&&(_=M/x.height),R=x.y+x.height/2;const e=x.x*_+p/2,t=(x.x+x.width)*_+p/2,{paths:i}=b;i[0][0][0]-=e/_,i[0][2][0]-=(t-p)/_}break;case"CIMPolygonSymbol":{v=x.x+x.width/2,R=x.y+x.height/2;const e=x.x*_+p/2,t=(x.x+x.width)*_+p/2,i=x.y*_+M/2,n=(x.y+x.height)*_+M/2,{rings:h}=b;e<0&&(h[0][0][0]-=e,h[0][3][0]-=e,h[0][4][0]-=e),i<0&&(h[0][0][1]+=i,h[0][1][1]+=i,h[0][4][1]+=i),t>p&&(h[0][1][0]-=t-p,h[0][2][0]-=t-p),n>M&&(h[0][2][1]+=n-M,h[0][3][1]+=n-M)}}const C={type:"cim",data:{type:"CIMSymbolReference",symbol:m}};return this.rasterize(C,p,M,v,R,_,l,1,b)}rasterize(e,t,i,n,r,s,c,u=0,g=null){const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d,m=this._canvas,f=(window.devicePixelRatio||1)*l;m.width=t*f,m.height=i*f,c||(c=(0,a.n5)(y)),g||(g=o(c,t,i,"legend")),m.width+=2*u,m.height+=2*u;const w=m.getContext("2d",{willReadFrequently:!0}),p=h.IT.createIdentity();return p.translate(-n,-r),p.scale(s*f,-s*f),p.translate(t*f/2+u,i*f/2+u),w.clearRect(0,0,m.width,m.height),new h.Rj(w,this._cimResourceManager,p,!0).drawSymbol(y,g),w.getImageData(0,0,m.width,m.height)}}function o(e,t,i,n){const h=-t/2+1,r=t/2-1,s=i/2-1,a=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[h,0],[0,0],[r,0]]]};default:return"legend"===n?{rings:[[[h,s],[r,0],[r,a],[h,a],[h,s]]]}:{rings:[[[h,s],[r,s],[r,a],[h,a],[h,s]]]}}}},93796:function(e,t,i){i.d(t,{previewCIMSymbol:function(){return f}});var n=i(23572),h=i(52644),r=i(22549),s=i(9427),a=i(77234),l=i(21550),c=i(63602);const o=new r.CIMSymbolRasterizer(null),u=(0,n.PN)(l.CB.size),g=(0,n.PN)(l.CB.maxSize),d=(0,n.PN)(l.CB.lineWidth),y=1;async function m(e,t,i){const n=t?.size;let r=null!=n&&"object"==typeof n&&"width"in n?n.width:n,a=null!=n&&"object"==typeof n&&"height"in n?n.height:n;if(null==r||null==a)if("esriGeometryPolygon"===i)r=u,a=u;else{const n=await async function(e,t,i){const{feature:n,fieldMap:r,viewParams:a}=t.cimOptions||t,l=await s.$.resolveSymbolOverrides(e.data,n,null,r,i,null,a);if(!l)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:l},e.data.primitiveOverrides=void 0;const c=[];return h.wp.fetchResources(l,o.resourceManager,c),h.wp.fetchFonts(l,o.resourceManager,c),c.length>0&&await Promise.all(c),h.wp.getEnvelope(l,null,o.resourceManager)}(e,t,i);n&&(r=n.width,a=n.height),"esriGeometryPolyline"===i&&(r=d),r=null!=r&&isFinite(r)?Math.min(r,g):u,a=null!=a&&isFinite(a)?Math.max(Math.min(a,g),y):u}return"legend"===t.style&&"esriGeometryPolyline"===i&&(r=d),{width:r,height:a}}async function f(e,t={}){const{node:i,opacity:h,symbolConfig:r}=t,s=null!=r&&"object"==typeof r&&"isSquareFill"in r&&r.isSquareFill,l=t.cimOptions||t,u=l.geometryType||(0,a.n5)(e?.data?.symbol),g=await m(e,t,u),{feature:d,fieldMap:y}=l,f=s||"esriGeometryPolygon"!==u?"preview":"legend",w=await o.rasterizeCIMSymbolAsync(e,d,g,f,y,u,null,l.viewParams,l.allowScalingUp);if(!w)return null;const{width:p,height:M}=w,b=document.createElement("canvas");b.width=p,b.height=M,b.getContext("2d").putImageData(w,0,0);const x=(0,n.Lz)(g.width),_=(0,n.Lz)(g.height),v=new Image(x,_);v.src=b.toDataURL(),v.ariaLabel=t.ariaLabel??null,v.alt=t.ariaLabel??"",null!=h&&(v.style.opacity=`${h}`);let R=v;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:x,height:_,src:v.src},fill:null,stroke:null,offset:[0,0]};R=(0,c.fz)([[e]],[x,_],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return i&&R&&i.appendChild(R),R}},71345:function(e,t,i){i.d(t,{A:function(){return h}});var n=i(14571);class h{constructor(e,t,i,h){this.transformedX=0,this.transformedY=0,this.center=(0,n.fA)(e,t),this.centerT=(0,n.vt)(),this.halfWidth=i/2,this.halfHeight=h/2,this.width=i,this.height=h}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new h(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const i=Math.abs(e.centerT[0]-this.centerT[0]),n=Math.abs(e.centerT[1]-this.centerT[1]),h=(e.halfWidth+this.halfWidth+t)/i,r=(e.halfHeight+this.halfHeight+t)/n,s=Math.min(h,r);return Math.log2(s)}extend(e){const t=Math.min(this.xmin,e.xmin),i=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,h=Math.max(this.ymax,e.ymax)-i,r=t+n/2,s=i+h/2;this.width=n,this.height=h,this.halfWidth=n/2,this.halfHeight=h/2,this.x=r,this.y=s}static deserialize(e){const t=e.readF32(),i=e.readF32(),n=e.readInt32(),r=e.readInt32();return new h(t,i,n,r)}}}}]);
//# sourceMappingURL=4974.9cdb3ddc3c1b7dea89f6.js.map