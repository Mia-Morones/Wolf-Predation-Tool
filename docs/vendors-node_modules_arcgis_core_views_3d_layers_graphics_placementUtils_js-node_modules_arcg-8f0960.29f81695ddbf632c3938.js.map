{"version":3,"file":"vendors-node_modules_arcgis_core_views_3d_layers_graphics_placementUtils_js-node_modules_arcg-8f0960.29f81695ddbf632c3938.js","mappings":"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","sources":["webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/layers/graphics/placementUtils.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/FontMetrics.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextHelperCanvas.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextRenderer.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/InstanceData.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/InstanceOctree.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/Intersector.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LevelSelector.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodComponentData.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodLevel.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodRenderer.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{copy as t,set as e}from\"../../../../core/libs/gl-matrix-2/math/vec2.js\";import{fromValues as r,ZEROS as o}from\"../../../../core/libs/gl-matrix-2/factories/vec2f64.js\";import{TextRenderAlignment as c,textVerticalPaddingPx as n}from\"../../webgl-engine/lib/TextRenderer.js\";const i=Object.freeze({left:0,center:.5,right:1}),s=Object.freeze({\"bottom-left\":r(0,0),bottom:r(.5,0),\"bottom-right\":r(1,0),left:r(0,.5),center:r(.5,.5),right:r(1,.5),\"top-left\":r(0,1),top:r(.5,1),\"top-right\":r(1,1)});function f(t){switch(t){case\"left\":return c.Left;case\"right\":return c.Right;default:return c.Center}}function a(t){switch(t){case\"bottom-left\":case\"left\":case\"top-left\":return\"left\";case\"bottom\":case\"center\":case\"top\":return\"center\";case\"bottom-right\":case\"right\":case\"top-right\":return\"right\"}}function l(t){switch(t){case\"bottom-left\":case\"bottom\":case\"bottom-right\":return\"bottom\";case\"left\":case\"center\":case\"right\":return\"center\";case\"top-left\":case\"top\":case\"top-right\":return\"top\"}}function m(t,e){switch(e){case\"bottom\":return\"left\"===t?\"bottom-left\":\"right\"===t?\"bottom-right\":\"bottom\";case\"center\":return t;case\"top\":return\"left\"===t?\"top-left\":\"right\"===t?\"top-right\":\"top\"}}function u(t){return\"middle\"===t?\"center\":t}function h(r,c){switch(r){case\"top\":return e(c,0,n);case\"bottom\":return e(c,0,-n);default:return t(c,o)}}export{m as anchorFromPlacements,a as horizontalPlacementFromAnchor,i as horizontalPlacementToAnchorX,s as namedAnchorToHUDMaterialAnchorPos,f as textRenderAlignmentFromHorizontalPlacement,u as verticalPlacementFromAlignment,l as verticalPlacementFromAnchor,h as verticalScreenOffsetFromAlignment};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{getTextHelperCanvas as t}from\"./TextHelperCanvas.js\";function e(e){const{size:c}=e.definition,a=e.fontString(c);let i=n.get(a);if(!i){const u=t(o,0,0).getContext(\"2d\");e.setFontProperties(u,c);const x=u.measureText(r);i=new s(x.actualBoundingBoxAscent,x.actualBoundingBoxDescent),n.set(a,i)}return i}const n=new Map;class s{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(t,e){this.maxAscent=t,this.maxDescent=e}}const o={canvas:null},r=(()=>{let t=\"\";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();export{e as getFontMetrics};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nfunction a(a,n,c){return a.canvas||(a.canvas=document.createElement(\"canvas\")),a.canvas.width=n,a.canvas.height=c,a.canvas}export{a as getTextHelperCanvas};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{clamp as t}from\"../../../../core/mathUtils.js\";import{debugFlags as e}from\"../../support/debugFlags.js\";import{getFontMetrics as i}from\"./FontMetrics.js\";import{getTextHelperCanvas as n}from\"./TextHelperCanvas.js\";const s=1;class r{constructor(t,e,i,n){this.text=t,this._alignment=e,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${t}--${this._parameters.key}-${this._alignment}`,this._lines=t.replaceAll(\" \",\" \").split(/\\r?\\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let t=this._metrics.firstLineAscent;for(let e=0;e<this._lines.length-1;e++)t+=this._lineSpacing;return t+=this._metrics.lastLineDescent,Math.ceil(t+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const t=n(a,l,l).getContext(\"2d\"),e=this._parameters.definition.pixelRatio,s=this._fontSize*e;this._parameters.setFontProperties(t,s);let r=2*this._haloSize;const h=this._parameters.definition.font;\"italic\"!==h.style&&\"oblique\"!==h.style&&\"bold\"!==h.weight&&\"bolder\"!==h.weight||(r+=.3*t.measureText(\"A\").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,d=0,_=0,g=0,m=0;this._lines.forEach(((i,n)=>{const s=t.measureText(i),h=s.width/e,a=h+r;this._textWidths.push(h),this._lineWidths.push(a),o=Math.max(o,a),g=Math.max(g,s.actualBoundingBoxAscent/e),m=Math.max(m,s.actualBoundingBoxDescent/e),0===n&&(d=s.actualBoundingBoxAscent/e),n===this._lines.length-1&&(_=s.actualBoundingBoxDescent/e)}));const f=i(this._parameters),u=Math.max(g,f.maxAscent),p=Math.max(m,f.maxDescent),x=d,R=\"underline\"===this._parameters.definition.font.decoration?p:_,S=o;this._metricsCached=new c(x,R,u,p,S)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*d}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,s)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const t=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(t,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case o.Left:return this._horizontalPadding;case o.Center:return(this.displayWidth-this._lineWidths[t])/2;case o.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[t]}}render(t,i,n){t.save();const s=i/=this.renderPixelRatio,r=n/=this.renderPixelRatio,h=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;i+=h,n+=o;const a=this._haloSize>0;a&&this._renderHalo(t,s,r,h,o),this._parameters.setFontProperties(t,this._renderedFontSize);for(let e=0;e<this._lines.length;++e){const s=this._lines[e],r=this._getLineXOffset(e);a&&(t.globalCompositeOperation=\"destination-out\",t.fillStyle=\"rgb(0, 0, 0)\",this._fillText(t,s,i+r,n),this._renderLineDecoration(t,i+r,n,this._textWidths[e])),t.globalCompositeOperation=\"source-over\",t.fillStyle=this._parameters.textStyle,this._fillText(t,s,i+this._getLineXOffset(e),n),this._renderLineDecoration(t,i+r,n,this._textWidths[e]),n+=this._lineSpacing}if(e.TEXT_SHOW_BASELINE){t.strokeStyle=_,t.setLineDash([2,2]),t.lineWidth=1;let e=r+o;for(let i=0;i<this._lines.length;++i)this._drawLine(t,[s,e],[s+this.displayWidth,e]),e+=this._lineSpacing}if(e.TEXT_SHOW_BORDER&&(t.strokeStyle=_,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,r],[this.displayWidth,this.displayHeight])),this._hasBackground){const e=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,r,e),t.globalCompositeOperation=\"destination-over\",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,e,i,n,s=!1){if(\"none\"===this._parameters.definition.font.decoration||0===n)return;const r=1,h=Math.max(this._parameters.definition.size/16,r);switch(this._parameters.definition.font.decoration){case\"underline\":i+=2*h;break;case\"line-through\":i-=.33*this._midLineAscent}const o=s?this._haloSize:0;t.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(h+2*o),t.beginPath(),t.moveTo(this._toRenderUnit(e-o),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(e+n+o),this._toRenderUnit(i)),t.stroke()}_roundedRect(e,i,n,s){i=this._toRenderUnit(i),n=this._toRenderUnit(n);const r=this.renderedWidth,h=this.renderedHeight;0!==s?(s=t(s,0,Math.floor(h/2)),e.beginPath(),e.moveTo(i,n+s),e.arcTo(i,n,i+s,n,s),e.lineTo(i+r-s,n),e.arcTo(i+r,n,i+r,n+s,s),e.lineTo(i+r,n+h-s),e.arcTo(i+r,n+h,i+r-s,n+h,s),e.lineTo(i+s,n+h),e.arcTo(i,n+h,i,n+h-s,s),e.closePath()):e.rect(i,n,r,h)}_renderHalo(t,e,i,s,r){const h=this.renderedWidth,o=this.renderedHeight,d=n(a,Math.max(h,l),Math.max(o,l)),_=d.getContext(\"2d\");_.clearRect(0,0,h,o),this._parameters.setFontProperties(_,this._renderedFontSize),_.fillStyle=this._parameters.haloStyle,_.strokeStyle=this._parameters.haloStyle;const c=this._renderedHaloSize<3;_.lineJoin=c?\"miter\":\"round\",c?this._renderHaloEmulated(_,s,r):this._renderHaloNative(_,s,r);let g=r;for(let n=0;n<this._lines.length;++n){const t=this._getLineXOffset(n);this._renderLineDecoration(_,s+t,g,this._textWidths[n],!0),g+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(d,0,0,h,o,this._toRenderUnit(e),this._toRenderUnit(i),h,o),t.globalAlpha=1}_renderHaloEmulated(t,e,i){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],r=this._getLineXOffset(n);for(const[n,o]of h)this._fillText(t,s,e+r+this._haloSize*n,i+this._haloSize*o);i+=this._lineSpacing}}_renderHaloNative(t,e,i){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const r=this._lines[s],h=this._getLineXOffset(s),o=5,a=.1;for(let s=0;s<o;s++){const d=1-(o-1)*a+s*a;t.lineWidth=this._toRenderUnit(d*n),this._strokeText(t,r,e+h,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,e,i,n){t.fillText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(t,e,i,n){t.strokeText(e,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(t,e,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(e[0])+.5,this._toRoundedRenderUnit(e[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,e,i){const n=this._toRenderUnit(e[0]),s=this._toRenderUnit(e[1]),r=this._toRenderUnit(i[0]),h=this._toRenderUnit(i[1]),o=Math.floor(n)+.5,a=Math.ceil(n+r)-.5,d=Math.floor(s)+.5,l=Math.ceil(s+h)-.5;t.beginPath(),t.moveTo(o,d),t.lineTo(a,d),t.lineTo(a,l),t.lineTo(o,l),t.lineTo(o,d),t.stroke()}}const h=[];{const t=16;for(let e=0;e<360;e+=360/t)h.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var o;!function(t){t[t.Left=0]=\"Left\",t[t.Center=1]=\"Center\",t[t.Right=2]=\"Right\"}(o||(o={}));const a={canvas:null},d=.2,l=512,_=\"rgb(255, 0, 255, 0.5)\";class c{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(t,e,i,n,s){this.firstLineAscent=t,this.lastLineDescent=e,this.maxLineAscent=i,this.maxLineDescent=n,this.displayWidth=s}}export{o as TextRenderAlignment,r as TextRenderer,s as textVerticalPaddingPx};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{BufferObject as e}from\"../../../../webgl/BufferObject.js\";import{Usage as t}from\"../../../../webgl/enums.js\";class r{constructor(r,i,s){this._elementSize=i,this._buffer=e.createVertex(r,t.STATIC_DRAW),this.resize(s)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r,i=0){const s=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}export{r as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../../chunks/tslib.es6.js\";import e from\"../../../../../core/Accessor.js\";import{reallocGrowthFactor as s}from\"../../../../../core/arrayUtils.js\";import i from\"../../../../../core/Evented.js\";import{property as a}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Logger.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{fromMat4 as o,invert as h,transpose as l}from\"../../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as n}from\"../../../../../core/libs/gl-matrix-2/factories/mat3f64.js\";import{multiply as c}from\"../../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as g}from\"../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{i as m}from\"../../../../../chunks/vec32.js\";import{create as f}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{BufferViewMat4f64 as d,BufferViewVec3f64 as _,BufferViewMat3f as p,BufferViewVec2f as T,BufferViewVec4f64 as u,BufferViewVec4f as L,BufferViewVec4u8 as E,BufferViewUint8 as A}from\"../../../../../geometry/support/buffer/BufferView.js\";import{scaleFromMatrix as v}from\"../../../support/mathUtils.js\";import{newLayout as M}from\"../../../support/buffer/InterleavedLayout.js\";import{assert as O}from\"../Util.js\";import{VertexAttribute as I}from\"../VertexAttribute.js\";import{initialCapacity as S}from\"./RenderInstanceData.js\";var F;function C(t){let e=M().mat4f64(I.LOCALTRANSFORM).mat4f64(I.GLOBALTRANSFORM).vec4f64(I.BOUNDINGSPHERE).vec3f64(I.MODELORIGIN).mat3f(I.INSTANCEMODEL).mat3f(I.INSTANCEMODELNORMAL).vec2f(I.MODELSCALEFACTORS);return t.includes(I.FEATUREATTRIBUTE)&&(e=e.vec4f(I.FEATUREATTRIBUTE)),t.includes(I.COLOR)&&(e=e.vec4u8(I.COLOR)),t.includes(I.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(I.OBJECTANDLAYERIDCOLOR)),e=e.u8(I.STATE).u8(I.LODLEVEL),e}!function(t){t[t.ALLOCATED=1]=\"ALLOCATED\",t[t.DEFAULT_ACTIVE=2]=\"DEFAULT_ACTIVE\",t[t.VISIBLE=4]=\"VISIBLE\",t[t.HIGHLIGHT=8]=\"HIGHLIGHT\",t[t.HIGHLIGHT_ACTIVE=16]=\"HIGHLIGHT_ACTIVE\",t[t.REMOVE=32]=\"REMOVE\",t[t.TRANSFORM_CHANGED=64]=\"TRANSFORM_CHANGED\",t[t.ACTIVE=18]=\"ACTIVE\"}(F||(F={}));class R{constructor(t){this.localTransform=t.getField(I.LOCALTRANSFORM,d),this.globalTransform=t.getField(I.GLOBALTRANSFORM,d),this.modelOrigin=t.getField(I.MODELORIGIN,_),this.model=t.getField(I.INSTANCEMODEL,p),this.modelNormal=t.getField(I.INSTANCEMODELNORMAL,p),this.modelScaleFactors=t.getField(I.MODELSCALEFACTORS,T),this.boundingSphere=t.getField(I.BOUNDINGSPHERE,u),this.featureAttribute=t.getField(I.FEATUREATTRIBUTE,L),this.color=t.getField(I.COLOR,E),this.objectAndLayerIdColor=t.getField(I.OBJECTANDLAYERIDCOLOR,E),this.state=t.getField(I.STATE,A),this.lodLevel=t.getField(I.LODLEVEL,A)}}let b=class extends e{constructor(t,e){super(t),this.events=new i,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=C(e),this._capacity=S,this._buffer=this._layout.createBuffer(this._capacity),this._view=new R(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,F.ALLOCATED),this._size++,this.events.emit(\"instances-changed\"),t}removeInstance(t){const e=this._view.state;O(t>=0&&t<this._capacity&&!!(e.get(t)&F.ALLOCATED),\"invalid instance handle\"),this._getStateFlag(t,F.ACTIVE)?this._setStateFlags(t,F.REMOVE):this.freeInstance(t),this.events.emit(\"instances-changed\")}freeInstance(t){const e=this._view.state;O(t>=0&&t<this._capacity&&!!(e.get(t)&F.ALLOCATED),\"invalid instance handle\"),e.set(t,0),this._size--}setLocalTransform(t,e,s=!0){this._view.localTransform.setMat(t,e),s&&this.updateModelTransform(t)}getLocalTransform(t,e){this._view.localTransform.getMat(t,e)}setGlobalTransform(t,e,s=!0){this._view.globalTransform.setMat(t,e),s&&this.updateModelTransform(t)}getGlobalTransform(t,e){this._view.globalTransform.getMat(t,e)}updateModelTransform(t){const e=this._view,s=G,i=y;e.localTransform.getMat(t,D),e.globalTransform.getMat(t,N);const a=c(N,N,D);m(s,a[12],a[13],a[14]),e.modelOrigin.setVec(t,s),o(i,a),e.model.setMat(t,i);const r=v(G,a);r.sort(),e.modelScaleFactors.set(t,0,r[1]),e.modelScaleFactors.set(t,1,r[2]),h(i,i),l(i,i),e.modelNormal.setMat(t,i),this._setStateFlags(t,F.TRANSFORM_CHANGED),this.events.emit(\"instance-transform-changed\",{index:t})}getModelTransform(t,e){const s=this._view;s.model.getMat(t,y),s.modelOrigin.getVec(t,G),e[0]=y[0],e[1]=y[1],e[2]=y[2],e[3]=0,e[4]=y[3],e[5]=y[4],e[6]=y[5],e[7]=0,e[8]=y[6],e[9]=y[7],e[10]=y[8],e[11]=0,e[12]=G[0],e[13]=G[1],e[14]=G[2],e[15]=1}applyShaderTransformation(t,e){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e)}getCombinedModelTransform(t,e){return this.getModelTransform(t,e),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e),e}getCombinedLocalTransform(t,e){this._view.localTransform.getMat(t,e),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e)}getCombinedMaxScaleFactor(t){let e=this._view.modelScaleFactors.get(t,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(G,this,t),e*=Math.max(G[0],G[1],G[2])),e}getCombinedMedianScaleFactor(t){let e=this._view.modelScaleFactors.get(t,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(G,this,t),e*=w(G[0],G[1],G[2])),e}getModel(t,e){this._view.model.getMat(t,e)}setFeatureAttribute(t,e){this._view.featureAttribute.setVec(t,e)}getFeatureAttribute(t,e){this._view.featureAttribute.getVec(t,e)}setColor(t,e){this._view.color.setVec(t,e)}setObjectAndLayerIdColor(t,e){this._view.objectAndLayerIdColor.setVec(t,e)}setVisible(t,e){e!==this.getVisible(t)&&(this._setStateFlag(t,F.VISIBLE,e),this.events.emit(\"instance-visibility-changed\",{index:t}))}getVisible(t){return this._getStateFlag(t,F.VISIBLE)}setHighlight(t,e,s){let i=this._highlightGroupMap.get(t);e?(i||(i=new Set,this._highlightGroupMap.set(t,i)),i.add(s)&&(this._setStateFlag(t,F.HIGHLIGHT,!0),this.events.emit(\"instance-highlight-changed\"))):i?.delete(s)&&(0===i.size&&(this._highlightGroupMap.delete(t),this._setStateFlag(t,F.HIGHLIGHT,!1)),this.events.emit(\"instance-highlight-changed\"))}getHighlight(t){return this._getStateFlag(t,F.HIGHLIGHT)}foreachHighlightGroupPrev(t,e){this._highlightGroupMapPrev.get(t)?.forEach(e),this._highlightGroupMapPrev.delete(t)}foreachHighlightGroup(t,e){const s=this._highlightGroupMap.get(t);s?.forEach(e),s?this._highlightGroupMapPrev.set(t,new Set(s)):this._highlightGroupMapPrev.delete(t)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let e=0;for(let s=0;s<this._capacity;++s){this.getState(s)&t&&++e}return e}_setStateFlags(t,e){const s=this._view.state;e=s.get(t)|e,s.set(t,e)}_clearStateFlags(t,e){const s=this._view.state;e=s.get(t)&~e,s.set(t,e)}_setStateFlag(t,e,s){s?this._setStateFlags(t,e):this._clearStateFlags(t,e)}_getStateFlag(t,e){return!!(this._view.state.get(t)&e)}_grow(){this._capacity=Math.max(S,Math.floor(this._capacity*s)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new R(this._buffer)}_findSlot(){const t=this._view.state;let e=this._next;for(;t.get(e)&F.ALLOCATED;)e=e+1===this._capacity?0:e+1;return this._next=e+1===this._capacity?0:e+1,e}};function w(t,e,s){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),s))}t([a({constructOnly:!0})],b.prototype,\"shaderTransformation\",void 0),t([a()],b.prototype,\"_size\",void 0),t([a({readOnly:!0})],b.prototype,\"size\",null),b=t([r(\"esri.views.3d.webgl-engine.lib.lodRendering.InstanceData\")],b);const G=f(),y=n(),D=g(),N=g();export{b as InstanceData,R as InstanceDataView,F as StateFlags};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{create as t}from\"../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{t as e}from\"../../../../../chunks/vec32.js\";import{w as s,c as i,a as r}from\"../../../../../chunks/sphere.js\";import{maxScale as a}from\"../../../support/mathUtils.js\";import h from\"../Octree.js\";class n extends h{constructor(e,r){super((t=>s(this._instanceData.view.boundingSphere.getVec(t,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=i(),this._tmpMat4=t()}addInstance(t){const s=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);e(r(this._tmpSphere),this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*a(i),s.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}export{n as InstanceOctree};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{IntersectorType as t}from\"../IntersectorInterfaces.js\";import{Graphic3DTarget as r}from\"../IntersectorTarget.js\";import{isValidIntersectorResult as e}from\"../intersectorUtils.js\";class s extends r{constructor(t,r,e,s,i,o){super(t,r),this.layerUid=t,this.graphicUid=r,this.geometryId=e,this.triangleNr=s,this.baseBoundingSphere=i,this.numLodLevels=o}}function i(r){return e(r)&&r.intersector===t.LOD&&!!r.target}export{s as LodTarget,i as isLodIntersectorResult};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nclass e{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,t){const c=t.computeScreenPixelSizeAt(e),r=this._worldSpaceRadius*i/c;let s=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)r>=this._minScreenSpaceRadii[a]&&(s=a);return s}}export{e as LevelSelector};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{glLayout as t}from\"../../../support/buffer/glUtil.js\";import{ContentObject as e}from\"../ContentObject.js\";import{Default3D as r}from\"../DefaultVertexAttributeLocations.js\";import{GLMaterials as s}from\"../GLMaterials.js\";import{newIntersectorResult as o}from\"../Intersector.js\";import{IntersectorType as n,StoreResults as i}from\"../IntersectorInterfaces.js\";import{VertexArrayObject as a}from\"../VertexArrayObject.js\";import{LodTarget as u}from\"./Intersector.js\";import{BufferObject as m}from\"../../../../webgl/BufferObject.js\";import{Usage as l}from\"../../../../webgl/enums.js\";function f(t,e,r,s=null){const o=t.createBufferWriter(),n=o.vertexBufferLayout,i=o.elementCount(e),a=n.createBuffer(i);return o.write(null,null,e,s,a,0),{material:t,vertexBufferLayout:n,buffer:a.buffer,elementCount:i,boundingInfo:r}}class d{constructor(o,n){const i=o.renderContext.rctx,u=n.geometry;let d=null;d=u instanceof e?f(u.material,u.attributes,u.boundingInfo):u;const c=d.material;this._materials=o.materials,c.setParameters({instancedDoublePrecision:!0}),this.geometry=u,this.material=c,this.glMaterials=new s(c,this._materials),this.vertexBufferLayout=d.vertexBufferLayout,this.vbo=m.createVertex(i,l.STATIC_DRAW,d.buffer),this.vao=new a(i,r,new Map([[\"geometry\",t(d.vertexBufferLayout)]]),new Map([[\"geometry\",this.vbo]])),this.vertexCount=d.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,s,a,m,l,f,d){if(!(this.geometry instanceof e))return;const c=this.geometry.id;this.material.intersect(this.geometry,t.transform.transform,t,s,a,((e,s,a,p,y)=>{if(e>=0){if(null!=r&&!r(t.rayBegin,t.rayEnd,e))return;const p=new u(l.layerUid,l.graphicUid(m),c,a,f,d);if((null==t.results.min.drapedLayerOrder||y>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||e<t.results.min.dist)&&t.results.min.set(n.LOD,p,e,s,t.transform.transform,y),t.options.store!==i.MIN&&(null==t.results.max.drapedLayerOrder||y>=t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||e>t.results.max.dist)&&t.results.max.set(n.LOD,p,e,s,t.transform.transform,y),t.options.store===i.ALL){const r=o(t.results.min.ray);r.set(n.LOD,p,e,s,t.transform.transform,y),t.results.all.push(r)}}}))}}export{d as LodComponentData,f as createLodComponentRenderGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{isSome as o}from\"../../../../../core/arrayUtils.js\";import{isAborted as n,throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import{create as e}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{empty as r,expandWithVec3 as i,center as s,diameter as c}from\"../../../../../geometry/support/aaBoundingBox.js\";import{LodComponentData as u}from\"./LodComponentData.js\";class a{static async create(e,r,i){const s=await Promise.allSettled(r.components.map((o=>e.controller.schedule((()=>new u(e,o)),i)))),c=s.map((o=>\"fulfilled\"===o.status?o.value:null)).filter(o);if(n(i)||c.length!==s.length){c.forEach((o=>o.destroy())),t(i);for(const o of s)if(\"rejected\"===o.status)throw o.reason}return new a(r.minScreenSpaceRadius,c)}constructor(o,n){this.minScreenSpaceRadius=o,this.components=n}destroy(){this.components.forEach((o=>o.destroy()))}intersect(o,n,t,e,r,i,s){this.components.forEach((c=>c.intersect(o,n,t,e,r,i,this.boundingSphere,s)))}get boundingBox(){if(null==this._boundingBox){const o=r();this.components.forEach((n=>{null!=n.boundingInfo&&(i(o,n.boundingInfo.bbMin),i(o,n.boundingInfo.bbMax))})),this._boundingBox=o}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const o=this.boundingBox,n=e();s(o,n),this._boundingSphere={center:n,radius:.5*c(o)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((o,n)=>o+n.triangleCount),0)}}export{a as LodLevel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{isSome as t}from\"../../../../../core/arrayUtils.js\";import r from\"../../../../../core/Error.js\";import{someMap as n}from\"../../../../../core/MapUtils.js\";import{destroyMaybe as a}from\"../../../../../core/maybe.js\";import{isAborted as s,throwIfAborted as i}from\"../../../../../core/promiseUtils.js\";import{property as o}from\"../../../../../core/accessorSupport/decorators/property.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Logger.js\";import{subclass as l}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{create as c}from\"../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{d as h,f as d,t as u}from\"../../../../../chunks/vec32.js\";import{create as f}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as m,fromValues as p}from\"../../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{debugFlags as _}from\"../../../support/debugFlags.js\";import{glLayout as g}from\"../../../support/buffer/glUtil.js\";import{newLayout as I}from\"../../../support/buffer/InterleavedLayout.js\";import y from\"../../../webgl/RenderCamera.js\";import{ShaderOutput as C}from\"../../core/shaderLibrary/ShaderOutput.js\";import{AsyncRenderPlugin as v}from\"../../effects/RenderPlugin.js\";import{Default3D as E}from\"../DefaultVertexAttributeLocations.js\";import{IntersectorType as R}from\"../IntersectorInterfaces.js\";import b from\"../Octree.js\";import{RenderSlot as D}from\"../RenderSlot.js\";import{assert as A}from\"../Util.js\";import{VertexAttribute as T}from\"../VertexAttribute.js\";import{InstanceData as L,StateFlags as S}from\"./InstanceData.js\";import{InstanceOctree as O}from\"./InstanceOctree.js\";import{LevelSelector as M}from\"./LevelSelector.js\";import{LodLevel as j}from\"./LodLevel.js\";import{RenderInstanceData as x}from\"./RenderInstanceData.js\";import{colorMixModes as N}from\"../../materials/internal/MaterialUtil.js\";import{encodeDoubleVec3 as w}from\"../../materials/renderers/utils.js\";import{DefaultMaterialDrawParameters as U}from\"../../shaders/DefaultMaterialTechnique.js\";import{TaskPriority as H,noBudget as F}from\"../../../../support/Scheduler.js\";import{bindVertexBufferLayout as V,unbindVertexBufferLayout as B}from\"../../../../webgl/Util.js\";const G=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new M(t,r)};let q=class extends v{constructor(e,t){super(e),this.type=R.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new y,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[D.OPAQUE_MATERIAL,e=>this._produces(e)],[D.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new L({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(H.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=k(this.optionalFields),this._glInstanceBufferLayout=g(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on(\"instances-changed\",(()=>this._requestUpdateCycle())),this._instanceData.events.on(\"instance-transform-changed\",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on(\"instance-visibility-changed\",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on(\"instance-highlight-changed\",(()=>this._requestUpdateCycle(!0)))])}get _allRenderInstanceData(){const e=[this._defaultRenderInstanceData];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const n=this._allRenderInstanceData[0][r].size+this._allRenderInstanceData[1][r].size,a=e.triangleCount;t.push({renderedInstances:n,renderedTriangles:n*a,trianglesPerInstance:a})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}_createRenderInstanceDataArray(e=[]){const{rctx:t}=this._context.renderContext;return this.symbol.levels.map((r=>{e.push(new x(t,this._instanceBufferLayout))})),e}async initializeRenderContext(e,r){this._context=e,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const n=await Promise.allSettled(this.symbol.levels.map((t=>j.create(e,t,r)))),a=n.map((e=>\"fulfilled\"===e.status?e.value:null)).filter(t);if(s(r)||a.length!==n.length){a.forEach((e=>e.destroy())),i(r);for(const e of n)if(\"rejected\"===e.status)throw e.reason}this._levels=a,this._levelSelector=G(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceDataMap.forEach((e=>e.forEach((e=>e.destroy()))))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>{const t=e.material.produces.get(D.TRANSPARENT_MATERIAL);return t?.(C.Color)}))))}hasHighlights(){return n(this._highlightRenderInstanceDataMap,(e=>e.some((e=>e.size>0))))}_produces(e){return e!==C.Highlight&&e!==C.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!_.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bind.contentCamera.equals(this._camera);this._camera.copyFrom(e.bind.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(F),this._needFullCycle=!1)}}acquireTechniques(e){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e);if(!t)return null;const r=new Array,n=this.levels;return t.forEach((t=>n.forEach((({components:n},a)=>n.forEach((n=>r.push(this._beginComponent(e,t[a],n)))))))),r}render(e,t){const r=this._getInstanceDatas(e);if(!r||null==t)return;let n=0;e.rctx.bindVAO();const a=this.levels;r.forEach((r=>a.forEach((({components:a},s)=>a.forEach((a=>this._renderComponent(e,t[n++],r[s],a,s)))))))}_getInstanceDatas(e){const{output:t,bind:r}=e,n=t===C.Highlight,a=!n&&t!==C.ShadowHighlight,s=t!==C.ShadowExcludeHighlight;if(a)return s?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(s){if(n){const{highlightGroupName:e}=r;if(!e)return null;const t=this._highlightRenderInstanceDataMap.get(e);return t?[t]:null}const e=[];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}return null}intersect(e,t,r,n){if(!this.baseMaterial.visible||null==this._octree)return;const a=f();h(a,n,r);const s=a=>{this._instanceData.getCombinedModelTransform(a,Y),e.transform.set(Y),u(J,r,e.transform.inverse),u(Q,n,e.transform.inverse);const s=this._instanceData.getState(a),i=this._instanceData.getLodLevel(a),o=this._levels.length;A(!!(s&S.ACTIVE),\"invalid instance state\"),A(i>=0&&i<o,\"invaid lod level\"),this._levels[i].intersect(e,t,J,Q,a,this.metadata,o)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(s):this._octree.forEachAlongRay(r,a,s)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new O(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&S.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=a(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,b.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(t,b.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==n)return{near:1/0,far:-1/0};const a=e.eye,s=this._instanceData.view;s.boundingSphere.getVec(r,K),h(K,K,a);const i=d(K,t)-K[3];s.boundingSphere.getVec(n,K),h(K,K,a);const o=d(K,t)+K[3];return{near:Math.max(e.near,i),far:Math.min(e.far,o)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:n,_levelSelector:a}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const s=this._instanceData,i=s.view;let o=s.size;const l=s.capacity;let c=this._instanceIndex;const h=Math.ceil(l/500);for(let d=0;d<o&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const d=i.state.get(c);let u=0;if(!(d&S.ALLOCATED)){c=c+1===l?0:c+1,o++;continue}const f=i.lodLevel.get(c);if(d&S.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),d&S.HIGHLIGHT_ACTIVE&&s.foreachHighlightGroupPrev(c,(e=>{const t=this._highlightRenderInstanceDataMap.get(e);if(!t)throw new r(\"Internal error in lodRenderer\");t[f].freeTail()})),d&S.REMOVE)s.freeInstance(c);else if(d&S.VISIBLE){let e=0;t&&(i.modelOrigin.getVec(c,W),e=a.selectLevel(W,s.getCombinedMedianScaleFactor(c),n)),u=d&~(S.ACTIVE|S.TRANSFORM_CHANGED),e>=0&&(d&S.HIGHLIGHT?(s.foreachHighlightGroup(c,(t=>{let n=this._highlightRenderInstanceDataMap.get(t);if(n||(n=this._createRenderInstanceDataArray(),n.forEach((e=>e.beginUpdate())),this._highlightRenderInstanceDataMap.set(t,n)),e>=n.length)throw new r(`LodRenderer internal error - missing lodLevel ${e}`);P(n[e],i,c)})),u|=S.HIGHLIGHT_ACTIVE):(P(this._defaultRenderInstanceData[e],i,c),u|=S.DEFAULT_ACTIVE)),i.state.set(c,u),i.lodLevel.set(c,e)}else u=d&~(S.ACTIVE|S.TRANSFORM_CHANGED),i.state.set(c,u);if(null!=this._octreeCached){const e=!!(d&S.ACTIVE),t=!!(u&S.ACTIVE);!e&&t?this._octreeCached.addInstance(c):e&&!t?this._octreeCached.removeInstance(c):e&&t&&d&S.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%h==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,r){if(0===t.size)return null;const n=r.glMaterials.load(e.rctx,e.bind.slot,e.output);return n?.beginSlot(e.bind)}_renderComponent(e,t,r,n,a){if(!t)return;const{bind:s,rctx:i}=e;i.runAppleAmdDriverHelper();const o=i.bindTechnique(t,s,n.material.parameters,$);i.bindVAO(n.vao),t.ensureAttributeLocations(n.vao),_.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===C.Color&&(o.setUniform4fv(\"externalColor\",Z[Math.min(a,Z.length-1)]),o.setUniform1i(\"colorMixMode\",N.replace));const l=r.capacity,c=r.headIndex,h=r.tailIndex,d=r.firstIndex,u=this._glInstanceBufferLayout,f=(e,a)=>{V(i,E,r.buffer,u,e),i.drawArraysInstanced(t.primitiveType,0,n.vertexCount,a-e),B(i,E,r.buffer,u)};n.material.parameters.transparent&&null!=d?c>h?(A(d>=h&&d<=c,\"invalid firstIndex\"),f(d,c),f(h,d)):c<h&&(d<=c?(A(d>=0&&d<=c,\"invalid firstIndex\"),f(d,c),f(h,l),f(0,d)):(A(d>=h&&d<=l,\"invalid firstIndex\"),f(d,l),f(0,c),f(h,d))):c>h?f(h,c):c<h&&(f(0,c),f(h,l)),i.bindVAO(null)}};function P(e,t,r){const n=e.allocateHead();z(t,r,e.view,n)}function z(e,t,r,n){w(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,n),r.model.copyFrom(n,e.model,t),r.modelNormal.copyFrom(n,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(n,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(n,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(n,e.featureAttribute,t)}function k(e){let t=I().vec3f(T.INSTANCEMODELORIGINHI).vec3f(T.INSTANCEMODELORIGINLO).mat3f(T.INSTANCEMODEL).mat3f(T.INSTANCEMODELNORMAL);return null!=e&&e.includes(\"featureAttribute\")&&(t=t.vec4f(T.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes(\"color\")&&(t=t.vec4u8(T.INSTANCECOLOR)),null!=e&&e.includes(\"objectAndLayerIdColor\")&&(t=t.vec4u8(T.INSTANCEOBJECTANDLAYERIDCOLOR)),t}e([o({constructOnly:!0})],q.prototype,\"symbol\",void 0),e([o({constructOnly:!0})],q.prototype,\"optionalFields\",void 0),e([o({constructOnly:!0})],q.prototype,\"metadata\",void 0),e([o({constructOnly:!0})],q.prototype,\"shaderTransformation\",void 0),e([o()],q.prototype,\"_instanceData\",void 0),e([o()],q.prototype,\"_cycleStartIndex\",void 0),e([o({readOnly:!0})],q.prototype,\"_enableLevelSelection\",null),e([o()],q.prototype,\"_updateCyclesWithStaticCamera\",void 0),e([o({readOnly:!0})],q.prototype,\"running\",null),q=e([l(\"esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer\")],q);const W=f(),K=m(),Y=c(),J=f(),Q=f(),Z=[p(1,0,1,1),p(0,0,1,1),p(0,1,0,1),p(1,1,0,1),p(1,0,0,1)],$=new U;export{q as LodRenderer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{reallocShrinkThreshold as t,reallocGrowthFactor as i,reallocShrinkFactor as e}from\"../../../../../core/arrayUtils.js\";import{BufferViewVec3f as s,BufferViewMat3f as a,BufferViewVec4f as r,BufferViewVec4u8 as n}from\"../../../../../geometry/support/buffer/BufferView.js\";import{assert as h}from\"../Util.js\";import{VertexAttribute as d}from\"../VertexAttribute.js\";import _ from\"./BackedBufferObject.js\";class c{constructor(t){this.modelOriginHi=t.getField(d.INSTANCEMODELORIGINHI,s),this.modelOriginLo=t.getField(d.INSTANCEMODELORIGINLO,s),this.model=t.getField(d.INSTANCEMODEL,a),this.modelNormal=t.getField(d.INSTANCEMODELNORMAL,a),this.featureAttribute=t.getField(d.INSTANCEFEATUREATTRIBUTE,r),this.color=t.getField(d.INSTANCECOLOR,n),this.objectAndLayerIdColor=t.getField(d.INSTANCEOBJECTANDLAYERIDCOLOR,n)}}class f{constructor(t,i){this._rctx=t,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){h(!this._updating,\"already updating\"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){h(this._updating,\"not updating\"),this.size<t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){h(this._updating,\"not updating\"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),h(this._headIndex!==this._tailIndex,\"invalid pointers\"),t}freeTail(){h(this._updating,\"not updating\"),h(this.size>0,\"invalid size\");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(u,Math.floor(this._capacity*i));this._resize(t)}_shrink(){const t=Math.max(u,Math.floor(this._capacity*e));this._resize(t)}_resize(t){if(h(this._updating,\"not updating\"),t===this._capacity)return;const i=new _(this._rctx,this._instanceBufferLayout.stride,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const t=this.size,e=this._compactInstances(i);h(e===t,\"invalid compaction\"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=e,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new c(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,e=this._tailIndex;return e<i?(this._buffer.copyRange(e,i,t),i-e):e>i?(this._buffer.copyRange(e,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-e),i+(this._capacity-e)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const u=64;export{f as RenderInstanceData,c as RenderInstanceDataView,u as initialCapacity};\n"],"names":[],"sourceRoot":""}