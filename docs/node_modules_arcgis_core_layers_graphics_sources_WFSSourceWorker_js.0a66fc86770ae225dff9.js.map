{"version":3,"file":"node_modules_arcgis_core_layers_graphics_sources_WFSSourceWorker_js.0a66fc86770ae225dff9.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAC66B,+BAA+B,QAAQ,cAAc,+EAA+E,UAAU,oDAAoD,iBAAiB,EAAE,MAAM,wKAAwK,IAAI,gDAAgD,CAAC,gFAAC,yBAAyB,IAAI,MAAM,kFAAC,MAAM,MAAM,UAAU,sDAAC,sDAAsD,2CAA2C,EAAE,qEAAC,mEAAmE,gEAAC,gBAAgB,4EAA4E,aAAa,wDAAC,CAAC,MAAM,sOAAsO,sCAAsC,0HAA0H,6BAA6B,6DAAC,EAAE,+HAA+H,6DAAC,EAAE,+BAA+B,EAAE,sDAAsD,oFAAoF,mBAAmB,UAAU,sDAAC,iFAAiF,wBAAwB,KAAK,EAAE,qFAAqF,4BAA4B,KAAK,EAAE,6FAA6F,yBAAyB,KAAK,EAAE,2FAA2F,sBAAsB,KAAK,EAAE,8FAA8F,0BAA0B,EAAE,gGAAgG,iBAAiB,wNAAwN,+DAAC,6BAA6B,SAAS,yCAAyC,0FAA0F,oBAAoB,uDAAC,uBAAuB,wDAAC,mDAAmD,kBAAkB,uDAAC,uBAAuB,wDAAC,4DAA4D,gBAAgB,GAAG,QAAQ,uCAAuC,uCAAuC,sEAAsE,8BAA8B,qDAAqD,IAAI,iCAAiC,OAAO,qCAAqC,2BAA2B,oGAAoG,kEAAC,iDAAiD,iDAAiD,SAAS,SAAS,WAAW,eAAe,6BAA6B,SAAS,mEAAC,eAAe,KAAK,4FAA4F,qCAAqC,UAAU,uBAAuB,OAAO,qEAAC,KAAK,6EAA6E,sBAAsB,cAAc,6DAAC,+GAA+G,iDAAiD,EAAE,+BAA+B,SAAS,EAAE,sBAAsB,uCAAuC,6DAAC,+GAA+G,yFAAyF,EAAE,+BAA+B,sBAAsB,EAAE,qBAAqB,qEAAC,0CAA0C,MAAM,sBAAsB,GAAG,qEAAC,IAAI,QAAQ,6EAAC,IAAI,0EAA0E,EAAE,IAAI,kFAAC,yGAAyG,+EAAC,CAAC,mEAAC,CAAC,6EAAC,iGAAiG,WAAW,kBAAkB,WAAW,uEAAC,2HAA2H,UAAU,kBAAkB,YAAY,IAAI,4BAA4B,wBAAwB,eAAe,KAAK,QAAQ,EAAE,IAAI,sBAAsB,aAAa,SAAS,mEAAC,eAAe,YAAY,cAAc,WAAW,gFAAgF,oEAAoE,mBAAmB,KAAK,oBAAoB,KAAK,gBAAgB,wEAAwE,mEAAmE,oDAAoD,wDAAwD,oBAAoB,0CAA0C,sBAAsB,YAAY,6GAA6G,KAA0B;;;;;;;;;;;;;;;;;;;;;;ACJ/kN;AACA;AACA;AACA;AAC0T,QAAQ,cAAc,sCAAsC,QAAQ,eAAe,oHAAoH,cAAc,gBAAgB,QAAQ,eAAe,kEAAkE,cAAc,gBAAgB,gBAAgB,uBAAuB,UAAU,kBAAkB,iBAAiB,eAAe,kBAAkB,qCAAqC,QAAQ,0EAAC,MAAM,cAAc,+EAAC,SAAS,aAAa,0FAA0F,OAAO,IAAI,YAAY,gBAAgB,QAAQ,OAAO,sEAAC,wCAAwC,qEAAC,6CAA6C,mEAAC,4BAA4B,wDAAC,KAAK,8EAAC,IAAI,MAAM,gBAAgB,QAAQ,mFAAC,aAAa,6BAA6B,6DAA6D,uBAAuB,SAAS,mBAAmB,yBAAyB,wZAAoD,IAAI,sBAAsB,CAAC,mFAAC,sEAAwN","sources":["webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js","webpack://react-redux-arcgis-boilerplate/./node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{throwIfAborted as a,isAbortError as s}from\"../../../core/promiseUtils.js\";import o from\"../../../core/Warning.js\";import{equals as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as i,convertToGeometry as u}from\"../featureConversionUtils.js\";import l from\"../data/FeatureStore.js\";import{checkProjectionSupport as h,project as c}from\"../data/projectionSupport.js\";import{QueryEngine as m}from\"../data/QueryEngine.js\";import{validateGeoJSON as p,createOptimizedFeatures as d}from\"./geojson/geojson.js\";import{mixAttributes as g}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as f,getFeatureCount as y,getFeature as _}from\"../../ogc/wfsUtils.js\";import x from\"../../support/FieldsIndex.js\";import{utc as C}from\"../../../time/timeZoneUtils.js\";const w=\"esri.layers.WFSLayer\";class R{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:s,getFeatureOutputFormat:o,fields:n,geometryType:i,featureType:u,maxRecordCount:c,maxTotalRecordCount:p,maxPageCount:d,objectIdField:g,customParameters:y}=e,{spatialReference:_,getFeatureSpatialReference:w}=f(s,u,e.spatialReference);try{await h(w,_)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:w,outSpatialReference:_})}a(r),this._customParameters=y,this._featureType=u,this._fieldsIndex=x.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:C}:null}),this._geometryType=i,this._getFeatureUrl=s,this._getFeatureOutputFormat=o,this._getFeatureSpatialReference=w,this._maxRecordCount=c,this._maxTotalRecordCount=p,this._maxPageCount=d,this._objectIdField=g,this._spatialReference=_;let R=await this._snapshotFeatures(r);if(R.errors.length>0&&(this._supportsPagination=!1,R=await this._snapshotFeatures(r),R.errors.length>0))throw R.errors[0];return this._queryEngine=new m({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,objectIdField:g,spatialReference:_,timeInfo:null,featureStore:new l({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(R.features),{warnings:T(R),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures({signal:e}))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of T(e))r.getLogger(w).warn(new o(\"wfs-layer:refresh-warning\",t.message,t.details));e.errors?.length&&r.getLogger(w).warn(new o(\"wfs-layer:refresh-error\",\"Refresh completed with errors\",{errors:e.errors}))}),(()=>{this._queryEngine.featureStore.clear()})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,o=this._maxPageCount,n=this._supportsPagination?await y(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let i=[];const u=[];if(null==n)try{i=await this._singleQuery(t)}catch(l){s(l)||u.push(l)}else{const e=Math.min(n,r),a=F(this,Math.max(1,Math.min(Math.ceil(e/this._maxRecordCount),o)),t);await Promise.allSettled(Array.from({length:10}).map((()=>S(a,i,u))))}return a(t),{features:i,totalRecordCount:n,maxTotalRecordCount:r,maxPageCount:o,errors:u}}async _singleQuery(e){const t=await _(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:e});return this._processGeoJSON(t,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await _(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){p(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:s}=t;a(s);const o=d(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!n(this._spatialReference,this._getFeatureSpatialReference))for(const a of o)null!=a.geometry&&(a.geometry=i(c(u(a.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let l=r??1;for(const a of o){const e={};g(this._fieldsIndex,e,a.attributes,!0),a.attributes=e,null==e[this._objectIdField]&&(a.objectId=e[this._objectIdField]=l++)}return o}}function*F(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}async function S(e,t,r){let a=e.next();for(;!a.done;){try{const e=await a.value;t.push(...e)}catch(o){s(o)||r.push(o)}a=e.next()}}function T(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:\"wfs-layer:maxRecordCount-too-low\",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:\"wfs-layer:large-dataset\",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}export{R as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{parseDate as t}from\"../../../../core/date.js\";import{isValid as n}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as e,validationErrorToString as r,isNumericField as i,isStringField as o,isDateField as s,sanitizeNullFieldValue as l}from\"../../../support/fieldUtils.js\";class u{constructor(){this.code=null,this.description=null}}class c{constructor(t){this.error=new u,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=t}}function f(t){return new c(t)}class a{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function d(t){return new a(t)}const m=new Set;function p(t,n,i,o=!1){m.clear();for(const s in i){const l=t.get(s);if(!l)continue;const u=g(l,i[s]);if(m.add(l.name),l&&(o||l.editable)){const t=e(l,u);if(t)return f(r(t,l,u));n[l.name]=u}}for(const e of t.requiredFields??[])if(!m.has(e.name))return f(`missing required field \"${e.name}\"`);return null}function g(n,e){let r=e;return i(n)&&\"string\"==typeof e?r=parseFloat(e):o(n)&&null!=e&&\"string\"!=typeof e?r=String(e):s(n)&&\"string\"==typeof e&&(r=t(e)),l(r)}let h;function y(t,e){if(!t||!n(e))return t;if(\"rings\"in t||\"paths\"in t){if(null==h)throw new TypeError(\"geometry engine not loaded\");return h.simplify(e,t)}return t}async function w(){return null==h&&(h=await import(\"../../../../geometry/geometryEngineJSON.js\")),h}async function j(t,e){!n(t)||\"esriGeometryPolygon\"!==e&&\"esriGeometryPolyline\"!==e||await w()}export{f as createFeatureEditErrorResult,d as createFeatureEditSuccessResult,j as loadGeometryEngineForSimplify,p as mixAttributes,y as simplify};\n"],"names":[],"sourceRoot":""}